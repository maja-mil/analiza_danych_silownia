---
title: "Analiza danych - siłownia"
author: "Oliwia Kolendowska, Magdalena Łuciw, Maja Milewczyk"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)

# Wczytywanie bibliotek
library(tidyverse)
library(vars)
library(naniar)
library(VIM)
library(finalfit)
library(validate)
library(forcats)
library(patchwork)
library(ggplot2)
library(tidyr)
library(forcats)
library(patchwork)
library(broom)  
library(car) 
library(emmeans)  
library(dplyr)

dane <- read_csv("dane/silownia_new.csv")
```

# Wstęp

::: {style="text-align: justify"}
Celem projektu zespołowego realizowanego w roku akademickim 2025/2026 była analiza danych dotyczących aktywności użytkowników siłowni, obejmująca zarówno ich charakterystyki demograficzne, jak i wskaźniki związane z wydajnością treningową. Projekt miał na celu zrozumienie, jakie czynniki wpływają na efektywność ćwiczeń oraz jakie wzorce zachowań można zaobserwować wśród osób regularnie korzystających z siłowni.
:::

## Opis danych

::: {style="text-align: justify"}
W projekcie został wykorzystany zbiór danych obejmujący 973 rekordy dotyczące członków siłowni. Każdy wpis zawiera zestaw informacji demograficznych, fizjologicznych oraz dotyczących nawyków treningowych. Dane pozwalają analizować zarówno podstawowe parametry zdrowotne, jak i bardziej zaawansowane wskaźniki wydajności. Zbiór zawiera zmienne przedstawione w poniższej tabeli wraz z opisem:
:::

| Nazwa zmiennej | Opis zmiennej |
|:-----------------------------------|:-----------------------------------|
| **Wiek** | Wiek uczestnika badania w latach |
| **Płeć** | Płeć uczestnika badania (Mężczyzna/Kobieta) |
| **Waga (kg)** | Masa ciała w kilogramach |
| **Wzrost (m)** | Wzrost w metrach |
| **Max_BPM** | Maksymalne tętno zanotowane podczas sesji treningowej |
| **Avg_BPM** | Średnie tętno podczas treningu |
| **Resting_BPM** | Tętno spoczynkowe przed rozpoczęciem ćwiczeń |
| **Session_Duration (h)** | Czas trwania sesji treningowej wyrażony w godzinach |
| **Calories_Burned** | Liczba kalorii spalonych w trakcie treningu |
| **Workout_Type** | Rodzaj aktywności (np. kardio, trening siłowy, joga, HIIT) |
| **Fat_Percentage** | Procent tkanki tłuszczowej |
| **Water_Intake (litry)** | Ilość wody wypitej w ciągu dnia treningowego |
| **Workout_Frequency (dni/tydzień)** | Ile dni w tygodniu użytkownik ćwiczy |
| **Experience_Level** | Poziom doświadczenia treningowego (1 – początkujący, 2 – średniozaawansowany, 3 – zaawansowany) |
| **BMI** | Wskaźnik masy ciała oparty na wzroście i wadze |

## Pytania badawcze

Przed przystąpieniem do analizy danych zostały sformułowane następujące pytania badawcze:

**1.** Czy czas trwania treningu wpływa na liczbę spalonych kalorii, a zależność różni się w zależności od typu treningu?

**2.** Czy wiek (Age) ma związek z tętnem spoczynkowym (Resting_BPM)?

**3.** Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?

**4.** Czy poziom doświadczenia (Experience_Level) wpływa na spalanie kalorii tak samo w każdym rodzaju treningu (Workout_Type)?

**5.** Czy występują różnice między kobietami i mężczyznami w intensywności treningów (Avg_BPM, Max_BPM) oraz liczbie spalonych kalorii?

**6.** Czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są dobrymi predyktorami efektywności treningu?

**7.** Czy częstotliwość ćwiczeń w tygodniu (Workout_Frequency) wpływa na wskaźniki zdrowotne, takie jak BMI czy Resting_BPM?

**8.** Czy w zbiorze danych można wyróżnić wyraźne grupy (klastry) użytkowników o podobnych parametrach fizycznych i treningowych?

**9.** Które zmienne najbardziej wpływają na średnie tętno podczas treningu (Avg_BPM)?

**10.** Czy ilość wypitej wody (Water_Intake) ma zauważalny związek z wydajnością treningową (Calories_Burned, Avg_BPM)?

# Porządkowanie i czyszczenie danych

::: {style="text-align: justify"}
W pierwszej kolejności przeprowadzono proces czyszczenia zbioru, aby zapewnić wysoką jakość i wiarygodność wyników. Kluczowym elementem tego etapu była szczegółowa weryfikacja braków danych.
:::

## Braki danych

::: {style="text-align: justify"}
Pierwszym zadaniem była identyfikacja braków danych. Przeprowadzona ocena kompletności zbioru wykazała, że w zbiorze znajduje się 80% obserwacji, które nie mają ani jednego braku w swoich danych (wierszach). Patrząc na zbiór przez pryzmat pojedynczych komórek, ogólny odsetek braków wynosi zaledwie 2,7%, co oznacza, że ponad 97% danych zostało poprawnie zarejestrowanych.

W celu identyfikacji zmiennych wymagających poprawy, wykorzystano wykres agregacji braków, ograniczając go do komuln pokazujących tylko te dane, w których znajdują się braki.
:::

```{r include=FALSE}
#Procent braków danych w zbiorze

procent <- prop_complete_var(dane)*100
procent
```

```{r include=FALSE}
#Wykres braków danych

naniar::vis_miss(dane)
```

```{r echo=FALSE}
dane_z_brakami <- dane[, colSums(is.na(dane)) > 0]

# Wykres procenta i wzroca braków danych

VIM::aggr(dane_z_brakami, 
          col=c('navyblue','red'), 
          numbers=TRUE, 
          sortVars=TRUE, 
          labels=names(dane_z_brakami), 
          cex.axis=0.7, 
          gap=3, 
          ylab=c("Procent braków danych", "Wzorzec braków danych"))
```

::: {style="text-align: justify"}
Analiza wizualna pozwala stwierdzić, że braki danych nie są rozproszone chaotycznie, lecz koncentrują się głównie w obrębie trzech zmiennych: Workout_Type (ok. 15%), BMI (ok. 15%) oraz Age (ok. 10%). Najczęstszym wzorcem, występującym bezpośrednio po rekordach kompletnych, jest brak pojedynczej wartości w ramach danej obserwacji. Przypadki, w których brakuje dwóch bądź trzech wartości jednocześnie, są rzadkie i stanowią łącznie poniżej 2% zbioru.
:::

## Imputacje danych

::: {style="text-align: justify"}
Po zidentyfikowaniu skali braków danych podjęto kroki mające na celu uzupełnienie niekompletnych informacji, co jest niezbędne do przeprowadzenia analiz statystycznych. W pierwszej kolejności wykonano obliczenia dla zmiennej BMI, wykorzystując dostępne dane o masie i wzroście użytkowników. Następnie, dla pozostałych braków w zmiennych takich jak rodzaj treningu czy wiek, zastosowano metodę imputacji Hot-Deck, która polega na zastępowaniu brakujących wartości pochodzącymi od innych, podobnymi pod względem cech obserwacji.

Po przeprowadzeniu imputacji ponownie oceniono kompletność danych, stwierdzając, że wszystkie braki zostały skutecznie uzupełnione.
:::

```{r include=FALSE}
dane$BMI <- dane$`Weight (kg)`/dane$`Height (m)`^2
dane_imp <- hotdeck(dane)
naniar::prop_miss(dane_imp)
```

# Walidacja danych

::: {style="text-align: justify"}
Kolejnym kluczowym etapem była walidacja danych, mająca na celu sprawdzenie ich poprawności merytorycznej oraz logicznej spójności. Został zdefiniowany zestaw dwunastu reguł weryfikujących dopuszczalne zakresy wartości dla poszczególnych zmiennych. Poniższy wykres przedstawia, które reguły nie zostały spełnione.
:::

```{r echo=FALSE}
## Reguły

dane$rec_id <- sprintf("%03d", 1:nrow(dane))


rules <- validator(
# 1. Wiek
Age >= 10,
Age <= 140,

# 2. Płeć
Gender %in% c("Male", "Female"),

# 3. Masa i wzrost
`Weight (kg)` >= 30,
`Weight (kg)` <= 250,
`Height (m)` >= 1.00,
`Height (m)` <= 2.50,

# 4. Spójność tętna
Resting_BPM >= 30,
Resting_BPM <= 120,
Max_BPM >= 100,
Max_BPM <= 220,
Avg_BPM > Resting_BPM,
Avg_BPM < Max_BPM,

# 5. Czas sesji
`Session_Duration (hours)` > 0,

# 6. Kalorie 
Calories_Burned > 0,
  
# 7. Dopuszczalne typy treningu (Workout_Type)
Workout_Type %in% c("Cardio", "Strength", "Yoga", "HIIT"),

# 8. Zakres zawartości tkanki tłuszczowej (Fat_Percentage)
Fat_Percentage >= 0,
Fat_Percentage <= 70,

# 9. Zakres spożycia wody (Water_Intake (liters))
`Water_Intake (liters)` > 0,

# 10. Częstotliwość treningów w tygodniu (Workout_Frequency (days/week))
`Workout_Frequency (days/week)` >= 1,
`Workout_Frequency (days/week)` <= 7,

# 11. Poziom doświadczenia (Experience_Level)
Experience_Level %in% c(1, 2, 3),

# 12. Zakres BMI
  BMI >= 10,
  BMI <= 60,

# 13. Spójność BMI z masą i wzrostem
abs(BMI - `Weight (kg)` / (`Height (m)`^2)) <= 0.01)

dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
barplot(cf, main = "dane")
```

<div style="text-align: justify">

Wykres przedstawia zbiorcze wyniki konfrontacji zbioru danych z dwunastoma zdefiniowanymi regułami logicznymi. Pozwala on na błyskawiczną ocenę kondycji merytorycznej danych po procesie czyszczenia i imputacji. Z wykresu wynika, że nie wszystkie obserwacje spełniają regułę Avg_BPM < Max_BPM, co oznacza, że w niektórych przypadkach średnie tętno jest wyższe od maksymalnego. Poniżej przedstawione jest szczegółowe zestawienie błędnych rekordów.

</div>

```{r echo=FALSE}
# Identyfikacja rekordów niespełniających reguły Avg_BPM < Max_BPM
bpm_err <- which(dane_imp$Avg_BPM >= dane_imp$Max_BPM)

tabela_bledow <- dane_imp[bpm_err, c( "Avg_BPM", "Max_BPM")]

knitr::kable(tabela_bledow, 
             caption = "Szczegółowe zestawienie wartości tętna dla rekordów błędnych",
             col.names = c("Średnie BPM (Avg_BPM)", "Maksymalne BPM (Max_BPM)"))
```

Krótki opis tego co jest wyżej.

## Naprawa danych

Po uzupełnieniu braków danych i zastosowaniu reguł walidacyjnych sprawdziliśmy, czy w zbiorze nie pozostały wartości sprzeczne logicznie. Większość obserwacji spełniała przyjęte warunki dotyczące wieku, wzrostu, masy ciała, BMI, czasu trwania treningu czy spalonych kalorii.

Jedyny problem dotyczył zmiennych opisujących tętno. W kilku rekordach średnie tętno podczas treningu (Avg_BPM) było równe lub nawet wyższe niż maksymalne zarejestrowane tętno (Max_BPM). Taka sytuacja jest nielogiczna, bo zgodnie z definicją to tętno maksymalne powinno być najwyższą wartością z całej sesji.

Założyliśmy, że błąd wynika z niedoszacowania wartości Max_BPM (np. chwilowego braku odczytu w momencie faktycznego maksimum), natomiast średnie tętno jest bardziej stabilne i wiarygodne. Dlatego zdecydowaliśmy się korygować wyłącznie Max_BPM. Dla wszystkich obserwacji, w których Avg_BPM było większe lub równe Max_BPM, zwiększyliśmy Max_BPM o 1 uderzenie na minutę względem wartości średniej. Zmiana ta jest bardzo niewielka, nie wpływa istotnie na rozkład zmiennej, a jednocześnie przywraca logiczną relację pomiędzy średnim i maksymalnym tętnem.

Po wprowadzeniu tej poprawki ponownie uruchomiliśmy procedurę walidacji. Wszystkie reguły zostały spełnione, a w danych nie pozostały już obserwacje oznaczone jako błędne.

```{r echo=FALSE}
# korekta: ustawiamy Max_BPM o 1 uderzenie/minutę wyżej niż Avg_BPM
dane_imp$Max_BPM[bpm_err] <- dane_imp$Avg_BPM[bpm_err] + 1

# Walidacja danych po poprawkach
dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
barplot(cf, main = "dane_imp_po_poprawkach")

```

Opis wykresu wyżej

# Analiza opisowa

```{r message=FALSE, warning=FALSE, include=FALSE}
# Ujednolicenie nazw i etykiet do tabel i wykresów
dane_desc <- dane_imp %>%
  rename(
    Weight = `Weight (kg)`,
    Height = `Height (m)`,
    Session_Duration = `Session_Duration (hours)`,
    Water_Intake = `Water_Intake (liters)`,
    Workout_Frequency = `Workout_Frequency (days/week)`
  ) %>%
  mutate(
    Gender = factor(Gender,
                    levels = c("Female", "Male"),
                    labels = c("Kobieta", "Mężczyzna")),
    Workout_Type = factor(Workout_Type,
                          levels = c("Cardio", "Strength", "Yoga", "HIIT"),
                          labels = c("Cardio", "Siłowy", "Joga", "HIIT")),
    Experience_Level = factor(Experience_Level,
                              levels = c(1, 2, 3),
                              labels = c("Początkujący", "Średniozaawansowany", "Zaawansowany"))
  )

# Podstawowe informacje o danych

tibble(
Liczba_obserwacji = nrow(dane_desc),
Liczba_zmiennych = ncol(dane_desc)
)

glimpse(dane_desc)

```

::: {style="text-align: justify"}
**Podstawowe informacje o danych**

Analiza opisowa została przeprowadzona na zbiorze danych obejmującym N = 973 obserwacje, gdzie każda obserwacja odpowiada pojedynczej sesji treningowej. Zbiór zawiera informacje opisujące zarówno cechy demograficzne i antropometryczne uczestników (m.in. wiek, płeć, masa ciała, wzrost, wskaźnik BMI), jak i parametry związane z przebiegiem treningu oraz reakcją organizmu (czas trwania sesji, spalone kalorie, typ treningu, poziom nawodnienia, częstotliwość treningów w tygodniu, poziom doświadczenia, a także wybrane wskaźniki tętna).

W ramach analizy wstępnej sprawdzono kompletność danych. W zbiorze występują braki dla części zmiennych, dlatego w dalszych opisach (np. w tabelach lub na wykresach) liczebność N może różnić się pomiędzy zmiennymi — w takich przypadkach podawana jest liczba obserwacji dostępnych dla danej cechy.
:::

```{r echo=FALSE}
# Statystyki opisowe zmiennych liczbowych

opis_liczbowe <- dane_desc %>%
  dplyr::select(dplyr::where(is.numeric)) %>%
  tidyr::pivot_longer(cols = dplyr::everything(),
                      names_to = "Zmienna",
                      values_to = "Wartosc") %>%
  dplyr::group_by(Zmienna) %>%
  dplyr::summarise(
    n = sum(!is.na(Wartosc)),
    srednia = round(mean(Wartosc, na.rm = TRUE), 2),
    odch_sd = round(sd(Wartosc, na.rm = TRUE), 2),
    mediana = round(median(Wartosc, na.rm = TRUE), 2),
    q1 = round(quantile(Wartosc, 0.25, na.rm = TRUE), 2),
    q3 = round(quantile(Wartosc, 0.75, na.rm = TRUE), 2),
    min = round(min(Wartosc, na.rm = TRUE), 2),
    max = round(max(Wartosc, na.rm = TRUE), 2),
    .groups = "drop"
  )

opis_liczbowe
```

::: {style="text-align: justify"}
**Statystyki opisowe zmiennych liczbowych**

W tabeli zestawiono podstawowe miary położenia i zróżnicowania zmiennych liczbowych (średnia, odchylenie standardowe, mediana, kwartyle oraz wartości minimalne i maksymalne). Po przygotowaniu danych (imputacji) dla analizowanych zmiennych liczbowych nie występują braki, dlatego dla każdej zmiennej liczebność wynosi n = 973.

Struktura wieku wskazuje na dominację osób dorosłych, z wyraźnym udziałem grupy w wieku średnim. Parametry tętna (spoczynkowe, średnie i maksymalne) mieszczą się w typowych zakresach dla osób aktywnych fizycznie i cechują się umiarkowanym zróżnicowaniem między obserwacjami. Wskaźniki masy ciała (waga i BMI) są bardziej zróżnicowane, co sugeruje niejednorodność próby pod względem budowy ciała. Największą zmienność w całym zbiorze wykazują spalone kalorie, co jest spójne z różnicami w intensywności oraz czasie trwania sesji. Zmiennie związane z zachowaniami treningowymi wskazują na regularną aktywność kilku razy w tygodniu, przy typowym czasie trwania treningu około jednej godziny. Szczegółowe wartości (średnie, mediany, kwartyle oraz minima i maksima) zaprezentowano w tabeli.

Podsumowując, w danych dominuje populacja dorosłych osób trenujących regularnie 3–4 razy w tygodniu, a największe zróżnicowanie widoczne jest w spalonych kaloriach oraz w BMI/masie ciała.
:::

```{r echo=FALSE}
# Struktura próby – zmienne jakościowe (częstości)

freq_tbl <- function(x) {
tibble(kategoria = as.character(x)) %>%
count(kategoria) %>%
mutate(odsetek = round(100 * n / sum(n), 1)) %>%
arrange(desc(n))
}

freq_tbl(dane_desc$Gender)
freq_tbl(dane_desc$Workout_Type)
freq_tbl(dane_desc$Experience_Level)

```

::: {style="text-align: justify"}
**Struktura próby – zmienne jakościowe (częstości)**

W tej części przedstawiono rozkłady częstości dla zmiennych jakościowych: płeć (Gender), typ treningu (Workout_Type) oraz poziom doświadczenia (Experience_Level). Analiza dotyczy pełnej próby n = 973 obserwacji (po imputacji i korekcie danych).

Struktura płci jest zbliżona do wyrównanej: mężczyźni stanowią 52,5% (n = 511), a kobiety 47,5% (n = 462), co oznacza niewielką przewagę mężczyzn (ok. 5 p.p.). Rozkład typów treningu jest również dość równomierny — najczęściej występują treningi Cardio (27,3%) oraz Siłowe (26,9%), a nieco rzadziej Joga (23,5%) i HIIT (22,2%); różnice między kategoriami są niewielkie (ok. 5 p.p.), co wskazuje na podobną reprezentację różnych form aktywności. W przypadku poziomu doświadczenia największą grupę stanowią osoby średniozaawansowane (41,7%), następnie początkujące (38,6%), a najmniej liczne są osoby zaawansowane (19,6%) — łącznie ok. 80% próby to poziom początkujący lub średniozaawansowany.

Wniosek ogólny: próba jest zróżnicowana pod względem analizowanych kategorii, a rozkłady są na tyle wyrównane (zwłaszcza dla typów treningu), że umożliwiają dalsze porównania między grupami bez ryzyka, że jedna kategoria „zdominuje” analizę.
:::

```{r echo=FALSE}

# Proste rozkłady wybranych zmiennych

p_age <- ggplot(dane_desc, aes(x = Age)) +
geom_histogram(bins = 20) +
labs(x = "Wiek", y = "Liczba osób")

p_bmi <- ggplot(dane_desc, aes(x = BMI)) +
geom_histogram(bins = 25) +
labs(x = "BMI", y = "Liczba osób")

p_cal <- ggplot(dane_desc, aes(x = Calories_Burned)) +
geom_histogram(bins = 25) +
labs(x = "Spalone kalorie", y = "Liczba sesji")

(p_age | p_bmi) / p_cal

```

::: {style="text-align: justify"}
**Proste rozkłady wybranych zmiennych**

Na wykresach przedstawiono histogramy wieku, BMI oraz liczby spalonych kalorii, co pozwala ocenić koncentrację obserwacji, asymetrię rozkładów oraz obecność wartości skrajnych.

Rozkład wieku jest względnie równomierny w całym analizowanym zakresie (około 18–59 lat). Nie widać wyraźnie dominującej grupy wieku, co sugeruje, że próba obejmuje szerokie spektrum osób dorosłych.

W przypadku BMI rozkład jest jednomodalny z wyraźnym ogonem prawostronnym. Najwięcej obserwacji koncentruje się w okolicach wartości typowych dla normy i lekkiej nadwagi, natomiast wraz ze wzrostem BMI częstości maleją. Widoczne są też pojedyncze wysokie wartości (około 45–50), wskazujące na obserwacje skrajne.

Rozkład spalonych kalorii również ma jeden główny szczyt i jest lekko skośny w prawo. Większość sesji mieści się w środkowym przedziale (około 700–1100 kcal), a bardzo wysokie wartości (powyżej ok. 1400–1500 kcal) występują rzadziej, podobnie jak niskie wyniki (około 300–500 kcal).

Podsumowując, spośród analizowanych zmiennych większą asymetrię i obecność wartości skrajnych obserwuje się dla BMI oraz spalonych kalorii, natomiast wiek ma rozkład bardziej równomierny.
:::

```{r echo=FALSE}

# Porównanie spalonych kalorii między typami treningu

  ggplot(dane_desc, aes(x = Workout_Type, y = Calories_Burned)) +
geom_boxplot() +
labs(x = "Typ treningu", y = "Spalone kalorie")
```

::: {style="text-align: justify"}
**Porównanie spalonych kalorii między typami treningu**

Wykres pudełkowy przedstawia rozkład spalonych kalorii w zależności od typu treningu (Cardio, Siłowy, Joga, HIIT). Widoczne jest duże nakładanie się rozkładów pomiędzy grupami, co sugeruje, że różnice między typami treningu są niewielkie w porównaniu do zróżnicowania wewnątrz grup. Mediany są zbliżone, przy czym HIIT osiąga nieco wyższe wartości centralne niż pozostałe kategorie, natomiast Cardio i trening siłowy prezentują bardzo podobny poziom spalonych kalorii. Największą zmienność wyników obserwuje się dla jogi, gdzie rozstęp wartości jest relatywnie szerszy. Dodatkowo we wszystkich typach treningu występują pojedyncze wysokie wartości odstające, co wskazuje, że niezależnie od kategorii zdarzają się sesje o wyjątkowo dużym wydatku energetycznym. Ogólnie wykres sugeruje, że ewentualny wpływ typu treningu na liczbę spalonych kalorii jest ograniczony, a kluczowe różnice wynikają raczej z indywidualnego przebiegu sesji.
:::

```{r echo=FALSE}
# Najsilniejsze korelacje między zmiennymi liczbowymi

cor_top10 <- dane_desc %>%
  dplyr::select_if(is.numeric) %>%
  cor(use = "pairwise.complete.obs") %>%
  as.data.frame() %>%
  tibble::rownames_to_column("Zmienna1") %>%
  tidyr::pivot_longer(-Zmienna1, names_to = "Zmienna2", values_to = "Korelacja") %>%
  dplyr::filter(Zmienna1 < Zmienna2) %>%
  dplyr::arrange(desc(abs(Korelacja))) %>%
  dplyr::slice_head(n = 10)

cor_top10

```

::: {style="text-align: justify"}
**Najsilniejsze korelacje między zmiennymi liczbowymi**

W tabeli przedstawiono 10 najsilniejszych zależności liniowych między zmiennymi liczbowymi (współczynnik korelacji Pearsona). Wartości dodatnie oznaczają współwystępowanie wzrostu obu zmiennych, a ujemne — wzrost jednej zmiennej przy spadku drugiej. Korelacje mają charakter opisowy i nie przesądzają o zależnościach przyczynowo-skutkowych.

Najsilniejszą dodatnią korelację zaobserwowano między Calories_Burned a Session_Duration (r = 0,908), co wskazuje na ścisły związek pomiędzy czasem trwania sesji a wydatkiem energetycznym. Wysoka korelacja występuje również między BMI a Weight (r = 0,853), zgodnie z konstrukcją wskaźnika BMI.

Wśród pozostałych dodatnich zależności zwracają uwagę związki między parametrami regularności treningu: Session_Duration i Workout_Frequency (r = 0,644) oraz Calories_Burned i Workout_Frequency (r = 0,576).

Najsilniejsze korelacje ujemne dotyczą zmiennej Fat_Percentage, która jest ujemnie powiązana m.in. ze spalonymi kaloriami (r = −0,598), spożyciem wody (r = −0,589), czasem sesji (r = −0,582) oraz częstotliwością treningów (r = −0,537). Dodatkowo zaobserwowano umiarkowane dodatnie korelacje Water_Intake z Weight (r = 0,394) oraz Height z Water_Intake (r = 0,394).

Podsumowując, najsilniejsze zależności dotyczą (1) relacji między czasem treningu i spalonymi kaloriami oraz (2) relacji między masą ciała i BMI, natomiast zmienna Fat_Percentage jest konsekwentnie ujemnie skorelowana z kilkoma miarami aktywności i parametrów treningu.
:::

# Wizualizacja danych

```{r}
dane_plot <- dane_desc

```

**Pytanie 1: Czy czas trwania treningu wpływa na liczbę spalonych kalorii, a zależność różni się w zależności od typu treningu?**

```{r}
ggplot(dane_plot, aes(Session_Duration, Calories_Burned)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ Workout_Type) +
  labs(title = "Spalone kalorie a czas trwania – osobno dla typów treningu",
       x = "Czas trwania [h]", y = "Spalone kalorie") +
  theme_minimal()
```

Na wykresach (osobno dla każdego typu treningu) widoczna jest wyraźna dodatnia zależność między czasem trwania sesji a liczbą spalonych kalorii — wraz ze wzrostem Session_Duration rośnie Calories_Burned. Linie regresji w poszczególnych panelach mają podobne nachylenie, co sugeruje, że sam wpływ czasu na spalanie kalorii jest zbliżony niezależnie od rodzaju aktywności. Jednocześnie zauważalne są niewielkie różnice w poziomie spalania kalorii (rozrzut i położenie punktów), co może oznaczać, że typ treningu w pewnym stopniu wpływa na liczbę spalonych kalorii, ale głównym czynnikiem pozostaje czas trwania ćwiczeń.

**Pytanie 2: Czy wiek (Age) ma związek z tętnem spoczynkowym (Resting_BPM)?**

```{r}

ggplot(dane_plot, aes(cut(Age, breaks = seq(15, 65, 5), right = FALSE), Resting_BPM)) +
  geom_boxplot(alpha = 0.6, outlier.alpha = 0.2) +
  labs(title = "Tętno spoczynkowe w grupach wiekowych (co 5 lat)",
       x = "Wiek (grupy)", y = "Resting_BPM") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Porównanie rozkładów tętna spoczynkowego w 5-letnich grupach wiekowych nie pokazuje wyraźnego, systematycznego trendu wzrostowego ani spadkowego. Mediany Resting_BPM w większości przedziałów są do siebie zbliżone (około niskich 60 BPM), a rozrzut wyników w grupach jest podobny. Oznacza to, że w analizowanym zbiorze wiek sam w sobie nie wydaje się silnie związany z tętnem spoczynkowym — większe różnice w Resting_BPM występują raczej między pojedynczymi osobami (wewnątrz grup) niż pomiędzy grupami wiekowymi.

**Pytanie 3: Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?**

```{r}

# Avg_BPM wg typu treningu

ggplot(dane_plot, aes(Workout_Type, Avg_BPM)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(width = 0.15, alpha = 0.15, size = 0.8) +
  labs(title = "Średnie tętno (Avg_BPM) wg typu treningu",
       x = "Typ treningu", y = "Avg_BPM") +
  theme_minimal()

# Calories_Burned wg typu treningu
ggplot(dane_plot, aes(Workout_Type, Calories_Burned)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(width = 0.15, alpha = 0.15, size = 0.8) +
  labs(title = "Spalone kalorie wg typu treningu",
       x = "Typ treningu", y = "Calories_Burned") +
  theme_minimal()

```

Na wykresach porównano rozkład średniego tętna (Avg_BPM) oraz liczby spalonych kalorii (Calories_Burned) w zależności od typu treningu (Workout_Type). W przypadku średniego tętna mediany i rozrzut wartości są bardzo podobne dla wszystkich typów (Cardio, HIIT, Strength, Yoga), co sugeruje, że rodzaj treningu nie różnicuje wyraźnie średniego poziomu tętna podczas sesji. Dla spalonych kalorii również widoczne jest duże nakładanie się rozkładów pomiędzy grupami — różnice w medianach są niewielkie, a w każdej kategorii występują wartości skrajne. Ogólnie wskazuje to, że w tym zbiorze danych typ treningu ma co najwyżej umiarkowany wpływ na Avg_BPM i Calories_Burned, a większa zmienność występuje pomiędzy osobami niż pomiędzy samymi typami aktywności.

**Pytanie 4: Czy poziom doświadczenia (Experience_Level) wpływa na spalanie kalorii tak samo w każdym rodzaju treningu (Workout_Type)?**

```{r}

ggplot(dane_plot, aes(x = Experience_Level, y = Calories_Burned, fill = Experience_Level)) +
  stat_summary(fun = "mean", geom = "bar", width = 0.7) +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), 
               vjust = -0.5, size = 3.5) +
  facet_wrap(~ Workout_Type) +
  coord_cartesian(clip = "off") +
  labs(title = "Gdzie doświadczenie ma największe znaczenie?",
       subtitle = "Średnie spalanie kalorii wg poziomu zaawansowania",
       x = "Poziom doświadczenia", 
       y = "Średnio spalone kalorie") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )

```

Wykresy przedstawiają średnią ilość spalonych kalorii w zależności od poziomu doświadczenia w każdym typie tregingu. Na wykresach widać, że osoby zaawansowane spalają średnio 80% więcej kalorii niżeli osoby będące na poziomie podstawowym. Różnica w spalaniu z podziałem na typu treningów nie jest znacząca. Ciekawym jest fakt, że podczas uprawiania jogi ćwiczący spalają podobną ilość kalorii co podczas innych treningów, pomimo tego, że przyjęło się, że joga jest mniej wymagającym rodzajem aktywności. Najwyższa średnią wartość spalonych kalorii widać w grupie zaawansowanej treningu siłowego (1318 kcal), co wskazuje, że ten rodzaj aktywności jest najefektyniejszy dla osób, które chcą szybciej spalać kalorie.

**Pytanie 5: Czy występują różnice między kobietami i mężczyznami w intensywności treningów (Avg_BPM, Max_BPM) oraz liczbie spalonych kalorii?**

```{r}

# Średnie tętno (Avf_BPM) wg płci

ggplot(dane_plot, aes(x = Gender, y = Avg_BPM, fill = Gender)) +
  geom_boxplot() +
  labs(title = "Różnice w średnim tętnie między płciami",
       x = "Płeć", y = "Avg_BPM") +
  theme_minimal() +
  theme(legend.position = "none")

# Maksymalne tętno (Max_BPM) wg płci

ggplot(dane_plot, aes(x = Gender, y = Max_BPM, fill = Gender)) +
  geom_boxplot() +
  labs(
    title = "Różnice w Maksymalnym Tętnie (Max_BPM) między Płciami",
    x = "Płeć",
    y = "Maksymalne Tętno (Max_BPM)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# Spalone kalorie (Calories_Burned) wg płci

ggplot(dane_plot, aes(x = Gender, y = Calories_Burned, fill = Gender)) +
  geom_boxplot() +
  labs(
    title = "Różnice w Spalonych Kaloriach (Calories_Burned) między Płciami",
    x = "Płeć",
    y = "Spalone Kalorie (Calories_Burned)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

Wykresy pokazały, że zarówno przeciętna intensywność oraz maksymalna intensywność treningów, o któej mówi nam średnie i maksymalne tętno, nie ma istotnej różnicy pomiędzy kobietami a mężczyznami. Natomiast pomimo podobnych wartości w tętnach mężczyźni spalają więcej kalorii niżeli kobiety. Różnica może wynikać na przykład przez mase ciała bądź skład mięśniowy ciała.

**Pytanie 6: Czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są dobrymi predyktorami efektywności treningu?**

```{r}
dane_calc <- dane_plot %>%
  mutate(
    Efficiency = Calories_Burned / Session_Duration,
    BMI_Group = cut(BMI, breaks = c(0, 18.5, 25, 30, 100), 
                    labels = c("Niedowaga", "Norma", "Nadwaga", "Otyłość")),
    Fat_Group = cut(Fat_Percentage, breaks = c(0, 15, 25, 100), 
                    labels = c("Sportowa (<15%)", "Przeciętna", "Wysoka (>25%)"))
  )

p1 <- ggplot(dane_calc %>% filter(!is.na(BMI_Group)), 
             aes(x = BMI_Group, y = Efficiency, fill = BMI_Group)) +
  stat_summary(fun = "mean", geom = "bar") +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), vjust = -0.5) +
  labs(title = "Efektywność wg BMI", x = "Grupa BMI", y = "Kcal / Godzinę") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() + 
  theme(legend.position = "none") +
  coord_cartesian(clip = "off")

p2 <- ggplot(dane_calc %>% filter(!is.na(Fat_Group)), 
             aes(x = Fat_Group, y = Efficiency, fill = Fat_Group)) +
  stat_summary(fun = "mean", geom = "bar") +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), vjust = -0.5) +
  labs(title = "Efektywność wg % Tłuszczu", x = "% Tłuszczu", y = "") +
  scale_fill_brewer(palette = "Reds") +
  theme_minimal() + 
  theme(legend.position = "none") +
  coord_cartesian(clip = "off")

p1 + p2 + 
  plot_annotation(
    title = "Analiza efektywności treningu",
    subtitle = "Średnie spalanie kalorii na godzinę w zależności od składu ciała"
  )
```

Z wykresu efektywności według BMI widać, że tylko dla ludzi, których BMI wskazuje wysoką nadwagę wartość spalanych kalorii się znacząco różni. Może wynikać to z fizycznego kosztu poruszania się większą masą ciała niż reszta. Natomiast z wykresu efektywności według poziomu tkanki tłuszczowej widać, że im mniej procent tłuszczu posiada osoba tym więcej kalorii spala. Wyższa efektywność u osób z mniejszą tkanką tłuszczową sugeruje większy udział masy mięśniowej w treningu.

**Pytanie 7 :Czy częstotliwość ćwiczeń w tygodniu (Workout_Frequency) wpływa na wskaźniki zdrowotne, takie jak BMI czy Resting_BPM?**

```{r}
# 7a. Wpływ częstotliwości na BMI
ggplot(dane_plot, aes(x = factor(Workout_Frequency), y = BMI, fill = factor(Workout_Frequency))) +
  geom_boxplot(alpha = 0.6, color = "darkgrey") +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1) +
  scale_fill_viridis_d(option = "mako", begin = 0.3, end = 0.8) +
  labs(title = "Częstotliwość treningów a BMI",
       subtitle = "Rozkład wskaźnika masy ciała względem liczby treningów w tygodniu",
       x = "Liczba treningów w tygodniu",
       y = "BMI",
       fill = "Dni/Tydzień") +
  theme_minimal() +
  theme(legend.position = "none")

# 7b. Wpływ częstotliwości na Tętno Spoczynkowe (Resting_BPM)
ggplot(dane_plot, aes(x = factor(Workout_Frequency), y = Resting_BPM, fill = factor(Workout_Frequency))) +
  geom_boxplot(alpha = 0.6, color = "darkgrey") +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1) +
  scale_fill_viridis_d(option = "rocket", begin = 0.3, end = 0.8) +
  labs(title = "Częstotliwość treningów a tętno spoczynkowe",
       subtitle = "Czy regularność treningów poprawia tętno spoczynkowe?",
       x = "Liczba treningów w tygodniu",
       y = "Resting_BPM (uderzenia/min)",
       fill = "Dni/Tydzień") +
  theme_minimal() +
  theme(legend.position = "none")
```

Analiza obu wykresów wykazuje, że wysoka częstotliwość treningów sprzyja stabilizacji kluczowych parametrów zdrowotnych, choć ich mediany pozostają zbliżone we wszystkich grupach. W przypadku wskaźnika BMI oraz tętna spoczynkowego (Resting_BPM) obserwujemy, że osoby trenujące najczęściej (5 razy w tygodniu) charakteryzują się najbardziej przewidywalnymi wynikami – u tych użytkowników rozkład danych jest najwęższy, co oznacza eliminację wartości skrajnych, takich jak wysokie stopnie otyłości czy nietypowo wysokie tętno spoczynkowe. Choć mediana BMI dla wszystkich grup oscyluje w granicach normy (24–25), a tętno spoczynkowe utrzymuje się na stabilnym poziomie ok. 61–63 uderzeń na minutę, to właśnie u osób ćwiczących 5 dni w tygodniu odnotowano najniższe wartości środkowe tętna. Można zatem wnioskować, że regularność treningowa w badanym zbiorze działa przede wszystkim jako czynnik stabilizujący organizm, chroniąc przed wynikami odbiegającymi od normy, natomiast sam wpływ liczby dni treningowych na średnie obniżenie BMI czy tętna jest zauważalny, lecz umiarkowany.

**Pytanie 8:Czy w zbiorze danych można wyróżnić wyraźne grupy (klastry) użytkowników o podobnych parametrach fizycznych i treningowych?**

```{r}
dane_do_klastrowania <- dane_plot %>% 
  dplyr::select(BMI, Fat_Percentage)

set.seed(123) # Stały punkt startowy, aby wyniki były zawsze takie same
klastry <- kmeans(dane_do_klastrowania, centers = 3)

dane_plot$Grupa <- as.factor(klastry$cluster)

ggplot(dane_plot, aes(x = BMI, y = Fat_Percentage, color = Grupa)) +
  geom_point(alpha = 0.6, size = 2.5) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Segmentacja użytkowników (Analiza skupień)",
       subtitle = "Podział na 3 grupy na podstawie BMI oraz tkanki tłuszczowej",
       x = "Wskaźnik BMI",
       y = "Procent tkanki tłuszczowej (%)",
       color = "Klaster (Grupa)") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Analiza obu parametrów fizycznych wykazuje, że algorytm klastrowania skutecznie wyodrębnił trzy grupy użytkowników o różnej charakterystyce budowy ciała. Wykres obrazuje silną, liniową zależność między BMI a procentem tkanki tłuszczowej, co pozwala na wyraźny podział populacji siłowni na segmenty. Grupa pierwsza skupia osoby o najniższych parametrach, reprezentujące sylwetki atletyczne lub osoby o niskiej masie ciała. Druga grupa to osoby o średnich, standardowych wartościach, natomiast trzecia grupa obejmuje użytkowników o wyższym BMI i poziomie tłuszczu, którzy mogą stanowić grupę docelową dla treningów redukcyjnych. Zastosowanie tej metody potwierdza, że parametry fizyczne są silnie ze sobą powiązane i pozwalają na automatyczne profilowanie klubowiczów bez konieczności ręcznego przypisywania ich do kategorii.

**Pytanie 9:Które zmienne najbardziej wpływają na średnie tętno podczas treningu (Avg_BPM)?**

```{r}
dane_kor <- dane_plot %>%
  dplyr::select(Avg_BPM, Max_BPM, Age, Weight, Height, 
                Session_Duration, Calories_Burned, 
                Fat_Percentage, Water_Intake, Workout_Frequency, BMI)

kor_wyniki <- as.data.frame(cor(dane_kor, use = "complete.obs")["Avg_BPM", ])
colnames(kor_wyniki) <- "Korelacja"
kor_wyniki$Zmienna <- rownames(kor_wyniki)
kor_wyniki <- kor_wyniki %>%
  filter(Zmienna != "Avg_BPM") %>%
  arrange(desc(abs(Korelacja)))

ggplot(kor_wyniki, aes(x = reorder(Zmienna, Korelacja), y = Korelacja, fill = Korelacja)) +
  geom_bar(stat = "identity") +
  coord_flip() + # Wykres poziomy dla lepszej czytelności nazw
  scale_fill_gradient2(low = "#4575b4", mid = "#ffffbf", high = "#d73027", midpoint = 0) +
  labs(title = "Czynniki wpływające na średnie tętno (Avg_BPM)",
       subtitle = "Siła powiązania parametrów z intensywnością wysiłku",
       x = "Parametr",
       y = "Współczynnik korelacji") +
  theme_minimal() +
  theme(legend.position = "none")
```

Analiza współczynników korelacji wykazuje, że średnie tętno podczas treningu jest najsilniej powiązane z tętnem maksymalnym (Max_BPM) oraz liczbą spalonych kalorii (Calories_Burned), co potwierdza bezpośrednią zależność między intensywnością wysiłku a wydatkiem energetycznym organizmu. Wykres obrazuje, że parametry takie jak czas trwania sesji (Session_Duration) również wykazują dodatni związek z tętnem, sugerując, że dłuższe i bardziej intensywne treningi utrzymują serce na wyższych obrotach. Z kolei zmienne demograficzne i fizyczne, takie jak wiek (Age) czy BMI, wykazują znacznie słabszy lub wręcz nieistotny wpływ na średnie tętno w tym zbiorze danych, co pozwala wnioskować, że o intensywności pracy serca na siłowni decyduje przede wszystkim charakter i dynamika samego treningu, a nie cechy budowy ciała czy wiek użytkownika. Całość wyników sugeruje, że monitoring Avg_BPM jest najlepszym wskaźnikiem bieżącego zaangażowania organizmu, niezależnym od stałych parametrów fizjologicznych klubowicza.

**Pytanie 10:Czy ilość wypitej wody (Water_Intake) ma zauważalny związek z wydajnością treningową (Calories_Burned, Avg_BPM)?**

```{r}
dane_grupy <- dane_plot %>%
  mutate(Calorie_Group = cut(Calories_Burned, 
                             breaks = seq(0, 2000, by = 250),
                             labels = c("0-250", "251-500", "501-750", "751-1000", 
                                        "1001-1250", "1251-1500", "1501-1750", "1751+"))) %>%
  filter(!is.na(Calorie_Group)) %>%
  group_by(Calorie_Group) %>%
  summarise(Avg_Water = mean(Water_Intake, na.rm = TRUE),
            n = n())
ggplot(dane_grupy, aes(x = Calorie_Group, y = Avg_Water, fill = Avg_Water)) +
  geom_bar(stat = "identity", color = "white", alpha = 0.8) +
  geom_text(aes(label = round(Avg_Water, 2)), v_just = -0.5, size = 3.5) +
  scale_fill_gradient(low = "#85c1e9", high = "#21618c") +
  labs(title = "Średnie spożycie wody w zależności od spalonych kalorii",
       subtitle = "Wyraźny trend: im większy wydatek energetyczny, tym więcej wypitej wody",
       x = "Przedział spalonych kalorii (kcal)",
       y = "Średnia ilość wody (litry)",
       fill = "Litry") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Analiza wykresu kolumnowego wykazuje bezpośrednią i liniową zależność między wydajnością treningową a nawodnieniem, wskazując, że oba te parametry rosną niemal równolegle. Podział danych na konkretne przedziały energetyczne pozwolił wyeliminować indywidualne odchylenia i ukazać stały trend wzrostowy: podczas gdy osoby spalające do 500 kcal wypijają średnio około 2 litrów wody, w grupach o najwyższej wydajności (powyżej 1750 kcal) średnie spożycie płynów wyraźnie wzrasta, osiągając najwyższe wartości. Taki układ danych jednoznacznie potwierdza, że zapotrzebowanie na wodę jest ściśle skorelowane z objętością wykonanej pracy, co sugeruje, że wyższe spożycie płynów stanowi fizjologiczną konieczność przy sesjach o wysokim wydatku energetycznym.

# Wnioskowanie statystyczne

W niniejszej części analizy przechodzimy od obserwacji opisowych do formalnego wnioskowania statystycznego. Celem tego etapu jest zweryfikowanie, czy zależności i różnice zaobserwowane w zbiorze danych (obejmującym 973 obserwacje) mają charakter systematyczny, czy też mogą być jedynie wynikiem przypadku. Traktujemy posiadane dane jako próbę, co pozwala nam na wyciąganie wniosków dotyczących szerszej populacji osób podejmujących aktywność fizyczną.

Wnioskowanie statystyczne oparto na integracji metod wizualnych z formalnymi testami statystycznymi, ograniczając ich zakres wyłącznie do postawionych pytań badawczych w celu zachowania przejrzystości analizy.

Przyjęto rygorystyczny poziom istotności alpha = 0,05, stosując jednocześnie korektę wartości p metodą Holma lub Benjamini-Hochberg (BH) w przypadku serii testów wykonywanych w ramach jednego pytania. Procedura ta pozwala na skuteczną kontrolę błędu I rodzaju i minimalizuje ryzyko błędnego uznania przypadkowych różnic za istotne statystycznie.

```{r message=FALSE, warning=FALSE}
alpha <- 0.05
```

**Pytanie 1: Czas trwania a kalorie – czy zależność zależy od typu treningu?**

Cel: Sprawdzić, czy związek między czasem trwania treningu a liczbą spalonych kalorii różni się w zależności od typu treningu.

Metoda: Dopasowano model regresji liniowej z interakcją Session_Duration (h) \* Workout_Type i przetestowano istotność interakcji (ANOVA dla modelu, testy F).

```{r}

# Model z interakcją: czy nachylenie zależy od typu treningu?
m1 <- lm(Calories_Burned ~ Session_Duration * Workout_Type, data = dane_plot)
car::Anova(m1, type = 2)

# Ponieważ interakcja nieistotna -> model uproszczony
m1_simpler <- lm(Calories_Burned ~ Session_Duration + Workout_Type, data = dane_plot)
summary(m1_simpler)

```

Wyniki: Czas trwania treningu miał istotny wpływ na liczbę spalonych kalorii (F(1,965)=4539.24, p\<0.001). Nie stwierdzono natomiast istotnej interakcji między czasem a typem treningu (F(3,965)=0.91, p=0.435), co oznacza, że nachylenie zależności jest podobne dla wszystkich typów treningu. Sam typ treningu również nie był istotny (F(3,965)=0.21, p=0.886).

Model uproszczony: W związku z brakiem interakcji dopasowano model bez interakcji. Współczynnik przy Session_Duration wyniósł 722.34, co oznacza wzrost spalonych kalorii średnio o ok. 722 kcal na dodatkową godzinę treningu (≈ 12 kcal na minutę). Model dobrze dopasowywał dane (R² = 0.825).

Wniosek: Liczba spalonych kalorii rośnie wyraźnie wraz z czasem trwania treningu, a typ treningu nie zmienia istotnie tej zależności.

**Pytanie 2: Wiek a tętno spoczynkowe**

Cel: Sprawdzić, czy wiek jest związany z tętnem spoczynkowym.

Metoda: Zastosowano korelację rang Spearmana.

```{r}
cor.test(dane_plot$Age, dane_plot$Resting_BPM, method = "spearman")

```

Wyniki: Nie stwierdzono istotnej zależności między wiekiem a tętnem spoczynkowym (rho = -0.007, p = 0.826). Wartość współczynnika jest bliska zeru, co wskazuje na brak związku również w sensie praktycznym.

Wniosek: W analizowanej próbie wiek nie wiąże się istotnie z tętnem spoczynkowym.

**Pytanie 3: Czy rodzaj treningu wpływa na Avg_BPM i Calories_Burned?**

Cel: Sprawdzić, czy średnie wartości Avg_BPM oraz Calories_Burned różnią się w zależności od typu treningu.

Metoda: Zastosowano jednoczynnikową analizę wariancji Welcha (ANOVA Welcha), która nie zakłada równości wariancji między grupami.

```{r}
# ANOVA Welcha (bez założenia równości wariancji)
oneway.test(Avg_BPM ~ Workout_Type, data = dane_plot)
oneway.test(Calories_Burned ~ Workout_Type, data = dane_plot)
```

Wyniki:

Dla Avg_BPM nie stwierdzono istotnych różnic między typami treningu (F(3, 531.71)=0.094, p=0.964).

Dla Calories_Burned również nie stwierdzono istotnych różnic (F(3, 533.12)=1.049, p=0.371).

Wniosek: W analizowanej próbie typ treningu nie wpływa istotnie ani na średnie tętno w trakcie treningu (Avg_BPM), ani na liczbę spalonych kalorii (Calories_Burned).

**Pytanie 4: Experience_Level a kalorie – czy efekt zależy od Workout_Type?**

Cel: Sprawdzić, czy poziom doświadczenia wpływa na liczbę spalonych kalorii oraz czy ten wpływ różni się w zależności od typu treningu.

Metoda: Dopasowano model regresji liniowej z interakcją Experience_Level \* Workout_Type. Następnie wykonano porównania post-hoc poziomów doświadczenia osobno w każdym typie treningu metodą emmeans z korektą BH.

```{r}
m4 <- lm(Calories_Burned ~ Experience_Level * Workout_Type, data = dane_plot)
car::Anova(m4, type = 2)

emmeans(m4, pairwise ~ Experience_Level | Workout_Type, adjust = "BH")
plot(emmeans(m4, ~ Experience_Level | Workout_Type), comparisons = TRUE)
```

Analiza wykazała istotny wpływ poziomu doświadczenia na liczbę spalonych kalorii we wszystkich badanych typach treningu (p\<0,0001). Porównując osoby początkujące, a zaawansowane widać, że największą różnice odnotowano w treningu siłowym, natomiast najmniejszą w cardio. Wyniki pokazują, że poziom doświadczenia jest silnie związany z liczbą spalonych kalorii: osoby bardziej doświadczone spalają istotnie więcej kalorii. Ten wzorzec jest widoczny we wszystkich typach treningu.

**Pytanie 5: Różnice Kobieta vs Mężczyzna (Avg_BPM, Max_BPM, Calories_Burned)**

Cel: Sprawdzić, czy kobiety i mężczyźni różnią się pod względem średniego tętna w trakcie treningu (Avg_BPM), maksymalnego tętna (Max_BPM) oraz liczby spalonych kalorii (Calories_Burned).

Metoda: Zastosowano test t Welcha dla dwóch niezależnych prób. Ponieważ wykonano trzy testy jednocześnie, uwzględniono korektę wartości p metodą Holma.

```{r}
t_avg <- t.test(Avg_BPM ~ Gender, data = dane_plot)
t_max <- t.test(Max_BPM ~ Gender, data = dane_plot)
t_cal <- t.test(Calories_Burned ~ Gender, data = dane_plot)

t_avg; t_max; t_cal

# korekta na 3 testy
p.adjust(c(t_avg$p.value, t_max$p.value, t_cal$p.value), method = "holm")

```

Analiza wykazała brak istotnych różnic między kobietami i mężczyznami pod względem średniego oraz maksymalnego tętna zarówno przed jak i po uwzględnieniu korekty wartości p metodą Holma. Obie grupy trenowały z podobną intensywnością sercową. Natomiast odnotowano istotną statystycznie różnicę w liczbie spalonych kalorii, która po korekcie wynosiła mniej niż 0,0001. Mężczyźni spalali średnio o 82,2 kcal więcej niż kobiety (944,5 vs 862,3 kcal), co przy braku różnic w tętnie sugeruje wpływ innych czynników, np. różnic w masie ciała lub składzie tkanek.

**Pytanie 6: Czy BMI i Fat_Percentage przewidują efektywność?**

Cel: Sprawdzić, czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są związane z efektywnością treningu zdefiniowaną jako Efficiency = Calories_Burned / Session_Duration.

Metoda: Utworzono zmienną Efficiency, a następnie dopasowano model regresji liniowej wielorakiej: Efficiency \~ BMI + Fat_Percentage.

```{r}
# przygotowanie danych do analizy efektywności
dane_calc <- dane_plot %>%
  mutate(Efficiency = Calories_Burned / Session_Duration) %>%
  filter(is.finite(Efficiency))

# regresja wieloraka
m6 <- lm(Efficiency ~ BMI + Fat_Percentage, data = dane_calc)
summary(m6)
```

Model regresji liniowej wykazał, że zarówno BMI, jak i procentowa zawartość tkanki tłuszczowej są istotnymi predyktorami efektywności spalania kalorii. Odnotowano przeciwstawne kierunki tych zależności: wyższe BMI sprzyja większemu wydatkowi energetycznemu (wzrost o 1,85 kcal/min na jednostkę BMI), natomiast wyższy poziom tkanki tłuszczowej obniża tę efektywność (spadek o 2,15 kcal/min na każdy 1% tłuszczu). Niska wartość skorygowanego współczynnika determinacji sugeruje jednak, że budowa ciała wyjaśnia jedynie niewielką część całkowitej zmienności tempa spalania kalorii.

**Pytanie 7: Czy Workout_Frequency wpływa na BMI i Resting_BPM?**

Cel: Sprawdzić, czy częstotliwość treningów w tygodniu (Workout_Frequency) wiąże się z różnicami w BMI oraz tętnie spoczynkowym (Resting_BPM).

Metoda: Zastosowano jednoczynnikową analizę wariancji Welcha (ANOVA Welcha), traktując Workout_Frequency jako zmienną grupującą (kategorie).

```{r}
test_bmi1 <- oneway.test(BMI ~ factor(Workout_Frequency), data = dane_plot)
test_bmi1
test_bpm1 <- oneway.test(Resting_BPM ~ factor(Workout_Frequency), data = dane_plot)
test_bpm1
# Korekta p value
p_values <- c(test_bmi1$p.value, test_bpm1$p.value)
p.adjust(p_values, method = "holm")
```

Analiza ANOVA Welcha nie wskazała istotnych różnic wskaźnika BMI (p=0,544) oraz tętna spoczynkowego (p=0,979) w zależności od częstotliwości treningów w tygodniu. Po zastosowaniu korekty Holma, oba wyniki osiągnęły wartość równą 1, co potwierdza brak istotności statystycznej obu zmiennych.

**Pytanie 8: Segmentacja (k-średnich) – czy klastry różnią się czymś więcej?**

Cel: Podział badanej populacji na grupy na podstawie parametrów budowy ciała (BMI oraz % tkanki tłuszczowej) i sprawdzenie, czy te grupy różnią się między sobą pod względem innych cech demograficznych, wydolnościowych i treningowych.

Metoda: Algorytm k-średnich (k=3) na ustandaryzowanych danych. Zbadanie zmiennych ilościowych testem ANOVA Welcha z korektą Holma dla wielokrotnych porównań. W przypadku zmiennych jakościowych wykorzystanie testu niezależności chi-kwadrat.

```{r}
{r}
library(dplyr)

set.seed(123)
dane_plot$Grupa <- factor(kmeans(scale(dane_plot[,c("BMI","Fat_Percentage")]),
                                 centers=3, nstart=25)$cluster)
dane_plot %>% group_by(Grupa) %>%
  summarise(n=n(), BMI=mean(BMI), Fat=mean(Fat_Percentage),
            Age=mean(Age), Cal=mean(Calories_Burned), Dur=mean(Session_Duration),
            Freq=mean(Workout_Frequency), .groups="drop")
vars <- c("Age","Calories_Burned","Session_Duration","Workout_Frequency","Resting_BPM","Avg_BPM")
p <- sapply(vars, \(v) oneway.test(reformulate("Grupa", v), data=dane_plot)$p.value)
data.frame(zmienna=vars, p=p, p_holm=p.adjust(p, "holm")) |> arrange(p_holm)

# (opcjonalnie) zmienne jakościowe (chi^2)
sapply(c("Gender","Workout_Type","Experience_Level"),
       \(v) chisq.test(table(dane_plot$Grupa, dane_plot[[v]]))$p.value)
```

Segmentacja wykazała, że osoby o najniższym BMI i poziomie tkanki tłuszczowej (Grupa 2) są jednocześnie najbardziej aktywne, wykonując średnio ponad 4 treningi tygodniowo i spalając o ok. 50% więcej kalorii niż pozostałe grupy. Mimo znaczących różnic w sylwetce i intensywności ćwiczeń (p\_{holm} \< 0,05), parametry tętna spoczynkowego oraz wiek badanych pozostają niemal identyczne we wszystkich klastrach. Analiza struktury grup potwierdza, że na profil budowy ciała silnie wpływa płeć oraz staż treningowy, natomiast sam rodzaj wybranej aktywności (np. Cardio vs Strength) nie różnicuje istotnie wydzielonych segmentów.

**Pytanie 9: Co najbardziej wpływa na Avg_BPM?**

Cel: Sprawdzić, które cechy użytkownika i treningu są statystycznie związane ze średnim tętnem podczas treningu (Avg_BPM), przy jednoczesnej kontroli pozostałych zmiennych.

Metoda: Zastosowano regresję liniową wieloraką, uwzględniając jednocześnie parametry treningowe i fizyczne (m.in. czas trwania, kalorie, wiek, BMI, płeć, typ treningu).

```{r}
m9 <- lm(
  Avg_BPM ~ Max_BPM + Session_Duration + Calories_Burned + Age +
    BMI + Fat_Percentage + Water_Intake + Workout_Frequency +
    Gender + Workout_Type + Experience_Level,
  data = dane_plot
)

summary(m9)
car::vif(m9)
```

Głównymi determinantami średniego tętna są czas trwania sesji, spalone kalorie oraz wiek, które wykazują bardzo wysoką istotność statystyczną (p \< 2e-16). Model wyjaśnia aż 80% zmienności, przy czym bycie mężczyzną wiąże się ze znaczącym spadkiem średniego tętna (o ok. 11,5 uderzeń na minutę) w porównaniu do kobiet, przy zachowaniu pozostałych parametrów na stałym poziomie. Co istotne, czynniki takie jak BMI, częstotliwość treningów czy poziom doświadczenia nie mają statystycznie istotnego wpływu na wartość Avg_BPM w tym modelu.

**Pytanie 10: Czy Water_Intake ma związek z wydajnością?**

Cel: Sprawdzić, czy ilość wypijanej wody (Water_Intake) jest związana ze spalonymi kaloriami (Calories_Burned) oraz ze średnim tętnem (Avg_BPM). Dodatkowo oceniono, czy związek z kaloriami utrzymuje się po uwzględnieniu czasu trwania treningu i typu treningu.

Metoda: Zastosowano korelację rang Spearmana (dla prostych zależności) oraz regresję liniową Calories_Burned \~ Water_Intake + Session_Duration + Workout_Type w celu kontroli czasu i typu treningu.

```{r}
cor.test(dane_plot$Water_Intake, dane_plot$Calories_Burned, method = "spearman", exact = FALSE)
cor.test(dane_plot$Water_Intake, dane_plot$Avg_BPM, method = "spearman", exact = FALSE)

m10 <- lm(Calories_Burned ~ Water_Intake + Session_Duration + Workout_Type, data = dane_plot)
summary(m10)

```

Ilość wypijanej wody jest silnie powiązana z większym wydatkiem energetycznym – każda dodatkowa jednostka nawodnienia wiąże się ze wzrostem spalonych kalorii o około 49 kcal. Zależność ta pozostaje statystycznie bardzo istotna (p \< 0,001) nawet przy uwzględnieniu czasu trwania i typu treningu. Jednocześnie badania nie wykazały żadnego istotnego związku między spożyciem wody a średnim tętnem podczas ćwiczeń (p = 0,858). Oznacza to, że nawodnienie sprzyja efektywności spalania kalorii, nie wpływając bezpośrednio na intensywność pracy serca.
