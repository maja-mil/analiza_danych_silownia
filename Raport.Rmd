---
title: "Analiza danych - siłownia"
author: "Oliwia Kolendowska, Magdalena Łuciw, Maja Milewczyk"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
library(tidyverse)
dane <- read_csv("dane/silownia_new.csv")
```

# Wstęp

Celem projektu zespołowego realizowanego w roku akademickim 2025/2026 jest analiza danych dotyczących aktywności użytkowników siłowni, obejmująca zarówno ich charakterystyki demograficzne, jak i wskaźniki związane z wydajnością treningową. Projekt ma na celu zrozumienie, jakie czynniki wpływają na efektywność ćwiczeń oraz jakie wzorce zachowań można zaobserwować wśród osób regularnie korzystających z siłowni.

## Opis danych

W projekcie wykorzystujemy zbiór danych obejmujący 973 rekordy dotyczące członków siłowni. Każdy wpis zawiera zestaw informacji demograficznych, fizjologicznych oraz dotyczących nawyków treningowych. Dane pozwalają analizować zarówno podstawowe parametry zdrowotne, jak i bardziej zaawansowane wskaźniki wydajności.

Najważniejsze zmienne w zbiorze:

**Wiek** – wiek użytkownika siłowni w latach.

**Płeć** – mężczyzna lub kobieta.

**Waga** (kg) – masa ciała w kilogramach.

**Wzrost** (m) – wzrost użytkownika w metrach.

**Max_BPM** – maksymalne tętno zanotowane podczas sesji treningowej.

**Avg_BPM** – średnie tętno podczas treningu.

**Resting_BPM** – tętno spoczynkowe przed rozpoczęciem ćwiczeń.

**Session_Duration** (h) – czas trwania sesji treningowej wyrażony w godzinach.

**Calories_Burned** – liczba kalorii spalonych w trakcie treningu.

**Workout_Type** – rodzaj aktywności (np. kardio, trening siłowy, joga, HIIT).

**Fat_Percentage** – procent tkanki tłuszczowej.

**Water_Intake** (litry) – ilość wody wypitej w ciągu dnia treningowego.

**Workout_Frequency** (dni/tydzień) – ile dni w tygodniu użytkownik ćwiczy.

**Experience_Level** – poziom doświadczenia treningowego (1 – początkujący, 2 – średniozaawansowany, 3 – zaawansowany).

**BMI** – wskaźnik masy ciała oparty na wzroście i wadze.

Zakres danych umożliwia analizę zależności pomiędzy cechami fizycznymi, stylem treningów i nawykami a realnymi wynikami osiąganymi podczas ćwiczeń.

## Pytania badawcze

**1.** Jakie zmienne mają największy wpływ na liczbę spalonych kalorii (Calories_Burned)?

**2.** Czy czas trwania treningu (Session_Duration) jest powiązany ze średnim tętnem (Avg_BPM) oraz liczbą spalonych kalorii?

**3.** Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?

**4.** Czy poziom doświadczenia (Experience_Level) wiąże się z większą wydajnością treningową (np. wyższym Calories_Burned lub niższym Avg_BPM)?

**5.** Czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są dobrymi predyktorami efektywności treningu?

**6.** Czy występują różnice między kobietami i mężczyznami w intensywności treningów (Avg_BPM, Max_BPM) oraz w liczbie spalonych kalorii?

**7.** Czy częstotliwość ćwiczeń w tygodniu (Workout_Frequency) wpływa na wskaźniki zdrowotne, takie jak BMI czy Resting_BPM?

**8.** Czy w zbiorze danych można wyróżnić wyraźne grupy (klastry) użytkowników o podobnych parametrach fizycznych i treningowych?

**9.** Które zmienne najbardziej wpływają na średnie tętno podczas treningu (Avg_BPM)?

**10.** Czy ilość wypitej wody (Water_Intake) ma zauważalny związek z wydajnością treningową (Calories_Burned, Avg_BPM)?

# Porządkowanie i czyszczenie danych

## Braki danych

```{r}
install.packages("naniar")
install.packages("vars")
library(vars)
library(naniar)
procent <- prop_complete_var(dane)*100
procent
```

```{r}
install.packages("VIM")
library(VIM)
VIM::aggr(dane_imp, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(dane_imp), cex.axis=.7, gap=3, ylab=c("Procent braków danych","Wzorzec braków danych"))
```
W danych znajduje się 80% kompletnych wartości. 

```{r}
naniar::vis_miss(dane)
```

## Wzorzec braków danych

```{r}
install.packages("finalfit")
library(finalfit)
missing_pattern(dane)
```

## Imputacje danych

```{r}
dane$BMI <- dane$`Weight (kg)`/dane$`Height (m)`^2
dane_imp <- hotdeck(dane)
naniar::prop_miss(dane_imp)
```

# Walidacja danych

## Reguły 

```{r}

dane$rec_id <- sprintf("%03d", 1:nrow(dane))

library(validate)
rules <- validator(
# 1. Wiek
Age >= 10,
Age <= 140,

# 2. Płeć
Gender %in% c("Male", "Female"),

# 3. Masa i wzrost
`Weight (kg)` >= 30,
`Weight (kg)` <= 250,
`Height (m)` >= 1.00,
`Height (m)` <= 2.50,

# 4. Spójność tętna
Resting_BPM >= 30,
Resting_BPM <= 120,
Max_BPM >= 100,
Max_BPM <= 220,
Avg_BPM > Resting_BPM,
Avg_BPM < Max_BPM,

# 5. Czas sesji
`Session_Duration (hours)` > 0,

# 6. Kalorie 
Calories_Burned > 0,
  
# 7. Dopuszczalne typy treningu (Workout_Type)
Workout_Type %in% c("Cardio", "Strength", "Yoga", "HIIT"),

# 8. Zakres zawartości tkanki tłuszczowej (Fat_Percentage)
Fat_Percentage >= 0,
Fat_Percentage <= 70,

# 9. Zakres spożycia wody (Water_Intake (liters))
`Water_Intake (liters)` > 0,

# 10. Częstotliwość treningów w tygodniu (Workout_Frequency (days/week))
`Workout_Frequency (days/week)` >= 1,
`Workout_Frequency (days/week)` <= 7,

# 11. Poziom doświadczenia (Experience_Level)
Experience_Level %in% c(1, 2, 3),

# 12. Zakres BMI
  BMI >= 10,
  BMI <= 60,

# 13. Spójność BMI z masą i wzrostem
abs(BMI - `Weight (kg)` / (`Height (m)`^2)) <= 0.01)

cf <- confront(dane, rules, key = "rec_id")
summary(cf)
barplot(cf, main = "dane")

# Identyfikacja rekordów niespełniających reguły Avg_BPM < Max_BPM
bpm_err <- which(dane_imp$Avg_BPM >= dane_imp$Max_BPM)

# Podgląd danych przed poprawą
dane_imp[bpm_err, c("Age", "Gender", "Resting_BPM", "Avg_BPM", "Max_BPM")]

# korekta: ustawiamy Max_BPM o 1 uderzenie/minutę wyżej niż Avg_BPM
dane_imp$Max_BPM[bpm_err] <- dane_imp$Avg_BPM[bpm_err] + 1

# Walidacja danych po poprawkach
dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
summary(cf)
barplot(cf, main = "dane_imp_po_poprawkach")

```


