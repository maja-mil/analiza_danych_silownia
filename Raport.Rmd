---
title: "Analiza danych - siłownia"
author: "Oliwia Kolendowska, Magdalena Łuciw, Maja Milewczyk"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(
  echo = FALSE,        # kod niewidoczny
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  fig.height = 5,
  fig.width = 8,
  dpi = 150,
  out.width = "90%",
  cache = TRUE,
  comment = NA 
)

# Wczytywanie bibliotek
library(tidyverse)
library(vars)
library(naniar)
library(VIM)
library(finalfit)
library(validate)
library(forcats)
library(patchwork)
library(ggplot2)
library(tidyr)
library(broom)  
library(car) 
library(emmeans)  
library(dplyr)
library(viridis)
library(dplyr)

dane <- read_csv("dane/silownia_new.csv")
```

# Wstęp

::: {style="text-align: justify"}
Celem projektu zespołowego realizowanego w roku akademickim 2025/2026 była analiza danych dotyczących aktywności użytkowników siłowni, obejmująca zarówno ich charakterystyki demograficzne, jak i wskaźniki związane z wydajnością treningową. Projekt miał na celu zrozumienie, jakie czynniki wpływają na efektywność ćwiczeń oraz jakie wzorce zachowań można zaobserwować wśród osób regularnie korzystających z siłowni.
:::

## Opis danych

::: {style="text-align: justify"}
W projekcie został wykorzystany zbiór danych obejmujący 973 rekordy dotyczące członków siłowni. Każdy wpis zawiera zestaw informacji demograficznych, fizjologicznych oraz dotyczących nawyków treningowych. Dane pozwalają analizować zarówno podstawowe parametry zdrowotne, jak i bardziej zaawansowane wskaźniki wydajności. Zbiór zawiera zmienne przedstawione w poniższej tabeli wraz z opisem:
:::

| Nazwa zmiennej | Opis zmiennej |
|:-----------------------------------|:-----------------------------------|
| **Wiek** | Wiek uczestnika badania w latach |
| **Płeć** | Płeć uczestnika badania (Mężczyzna/Kobieta) |
| **Waga (kg)** | Masa ciała w kilogramach |
| **Wzrost (m)** | Wzrost w metrach |
| **Max_BPM** | Maksymalne tętno zanotowane podczas sesji treningowej |
| **Avg_BPM** | Średnie tętno podczas treningu |
| **Resting_BPM** | Tętno spoczynkowe przed rozpoczęciem ćwiczeń |
| **Session_Duration (h)** | Czas trwania sesji treningowej wyrażony w godzinach |
| **Calories_Burned** | Liczba kalorii spalonych w trakcie treningu |
| **Workout_Type** | Rodzaj aktywności (np. kardio, trening siłowy, joga, HIIT) |
| **Fat_Percentage** | Procent tkanki tłuszczowej |
| **Water_Intake (litry)** | Ilość wody wypitej w ciągu dnia treningowego |
| **Workout_Frequency (dni/tydzień)** | Ile dni w tygodniu użytkownik ćwiczy |
| **Experience_Level** | Poziom doświadczenia treningowego (1 – początkujący, 2 – średniozaawansowany, 3 – zaawansowany) |
| **BMI** | Wskaźnik masy ciała oparty na wzroście i wadze |

## Pytania badawcze

Przed przystąpieniem do analizy danych zostały sformułowane następujące pytania badawcze:

**1.** Czy czas trwania treningu wpływa na liczbę spalonych kalorii, a zależność różni się w zależności od typu treningu?

**2.** Czy wiek (Age) ma związek z tętnem spoczynkowym (Resting_BPM)?

**3.** Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?

**4.** Czy poziom doświadczenia (Experience_Level) wpływa na spalanie kalorii tak samo w każdym rodzaju treningu (Workout_Type)?

**5.** Czy występują różnice między kobietami i mężczyznami w intensywności treningów (Avg_BPM, Max_BPM) oraz liczbie spalonych kalorii?

**6.** Czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są dobrymi predyktorami efektywności treningu?

**7.** Czy częstotliwość ćwiczeń w tygodniu (Workout_Frequency) wpływa na wskaźniki zdrowotne, takie jak BMI czy Resting_BPM?

**8.** Czy w zbiorze danych można wyróżnić wyraźne grupy (klastry) użytkowników o podobnych parametrach fizycznych i treningowych?

**9.** Które zmienne najbardziej wpływają na średnie tętno podczas treningu (Avg_BPM)?

**10.** Czy ilość wypitej wody (Water_Intake) ma zauważalny związek z wydajnością treningową (Calories_Burned, Avg_BPM)?

# Porządkowanie i czyszczenie danych

::: {style="text-align: justify"}
W pierwszej kolejności przeprowadzono proces czyszczenia zbioru, aby zapewnić wysoką jakość i wiarygodność wyników. Kluczowym elementem tego etapu była szczegółowa weryfikacja braków danych.
:::

## Braki danych

::: {style="text-align: justify"}
Pierwszym zadaniem była identyfikacja braków danych. Przeprowadzona ocena kompletności zbioru wykazała, że w zbiorze znajduje się 80% obserwacji, które nie mają ani jednego braku w swoich danych (wierszach). Patrząc na zbiór przez pryzmat pojedynczych komórek, ogólny odsetek braków wynosi zaledwie 2,7%, co oznacza, że ponad 97% danych zostało poprawnie zarejestrowanych.

W celu identyfikacji zmiennych wymagających poprawy, wykorzystano wykres agregacji braków, ograniczając go do kolumn pokazujących tylko te dane, w których znajdują się braki.
:::

```{r include=FALSE}
#Procent braków danych w zbiorze

procent <- prop_complete_var(dane)*100
procent
```

```{r include=FALSE}
#Wykres braków danych

naniar::vis_miss(dane)
```

```{r echo=FALSE}
dane_z_brakami <- dane[, colSums(is.na(dane)) > 0]

# Wykres wzorca i procenta braków danych

VIM::aggr(dane_z_brakami, 
          col=c('navyblue','red'), 
          numbers=TRUE, 
          sortVars=TRUE, 
          labels=names(dane_z_brakami), 
          cex.axis=0.7, 
          gap=3, 
          ylab=c("Procent braków danych", "Wzorzec braków danych"))
```

::: {style="text-align: justify"}
Analiza wizualna pozwala stwierdzić, że braki danych nie są rozproszone chaotycznie, lecz koncentrują się głównie w obrębie trzech zmiennych: Workout_Type (ok. 15%), BMI (ok. 15%) oraz Age (ok. 10%). Najczęstszym wzorcem, występującym bezpośrednio po rekordach kompletnych, jest brak pojedynczej wartości w ramach danej obserwacji. Przypadki, w których brakuje dwóch bądź trzech wartości jednocześnie, są rzadkie i stanowią łącznie poniżej 2% zbioru.
:::

## Imputacje danych

::: {style="text-align: justify"}
Po zidentyfikowaniu skali braków danych podjęto kroki mające na celu uzupełnienie niekompletnych informacji, co jest niezbędne do przeprowadzenia analiz statystycznych. W pierwszej kolejności wykonano obliczenia dla zmiennej BMI, wykorzystując dostępne dane o masie i wzroście użytkowników. Następnie, dla pozostałych braków w zmiennych takich jak rodzaj treningu czy wiek, zastosowano metodę imputacji Hot-Deck, która polega na zastępowaniu brakujących wartości pochodzącymi od innych, podobnymi pod względem cech obserwacji.

Po przeprowadzeniu imputacji ponownie oceniono kompletność danych, stwierdzając, że wszystkie braki zostały skutecznie uzupełnione.
:::

```{r include=FALSE}
dane$BMI <- dane$`Weight (kg)`/dane$`Height (m)`^2
dane_imp <- hotdeck(dane)
naniar::prop_miss(dane_imp)
```

# Walidacja danych

::: {style="text-align: justify"}
Kolejnym kluczowym etapem była walidacja danych, mająca na celu sprawdzenie ich poprawności merytorycznej oraz logicznej spójności. Został zdefiniowany zestaw dwunastu reguł weryfikujących dopuszczalne zakresy wartości dla poszczególnych zmiennych. Poniższy wykres przedstawia, które reguły nie zostały spełnione.
:::

```{r echo=FALSE}
## Reguły

dane$rec_id <- sprintf("%03d", 1:nrow(dane))


rules <- validator(
# 1. Wiek
Age >= 10,
Age <= 140,

# 2. Płeć
Gender %in% c("Male", "Female"),

# 3. Masa i wzrost
`Weight (kg)` >= 30,
`Weight (kg)` <= 250,
`Height (m)` >= 1.00,
`Height (m)` <= 2.50,

# 4. Spójność tętna
Resting_BPM >= 30,
Resting_BPM <= 120,
Max_BPM >= 100,
Max_BPM <= 220,
Avg_BPM > Resting_BPM,
Avg_BPM < Max_BPM,

# 5. Czas sesji
`Session_Duration (hours)` > 0,

# 6. Kalorie 
Calories_Burned > 0,
  
# 7. Dopuszczalne typy treningu (Workout_Type)
Workout_Type %in% c("Cardio", "Strength", "Yoga", "HIIT"),

# 8. Zakres zawartości tkanki tłuszczowej (Fat_Percentage)
Fat_Percentage >= 0,
Fat_Percentage <= 70,

# 9. Zakres spożycia wody (Water_Intake (liters))
`Water_Intake (liters)` > 0,

# 10. Częstotliwość treningów w tygodniu (Workout_Frequency (days/week))
`Workout_Frequency (days/week)` >= 1,
`Workout_Frequency (days/week)` <= 7,

# 11. Poziom doświadczenia (Experience_Level)
Experience_Level %in% c(1, 2, 3),

# 12. Zakres BMI
  BMI >= 10,
  BMI <= 60,

# 13. Spójność BMI z masą i wzrostem
abs(BMI - `Weight (kg)` / (`Height (m)`^2)) <= 0.01)

dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
barplot(cf, main = "dane")
```

::: {style="text-align: justify"}
Wykres przedstawia zbiorcze wyniki konfrontacji zbioru danych z dwunastoma zdefiniowanymi regułami logicznymi. Pozwala on na błyskawiczną ocenę kondycji merytorycznej danych po procesie czyszczenia i imputacji. Z wykresu wynika, że nie wszystkie obserwacje spełniają regułę Avg_BPM \< Max_BPM, co oznacza, że w niektórych przypadkach średnie tętno jest wyższe od maksymalnego. Poniżej przedstawione jest szczegółowe zestawienie błędnych rekordów.
:::

```{r echo=FALSE}
# Identyfikacja rekordów niespełniających reguły Avg_BPM < Max_BPM
bpm_err <- which(dane_imp$Avg_BPM >= dane_imp$Max_BPM)

tabela_bledow <- dane_imp[bpm_err, c( "Avg_BPM", "Max_BPM")]

knitr::kable(tabela_bledow, 
             caption = "Szczegółowe zestawienie wartości tętna dla rekordów błędnych",
             col.names = c("Średnie BPM (Avg_BPM)", "Maksymalne BPM (Max_BPM)"))
```

::: {style="text-align: justify"}
Jak wykazano w powyższej tabeli, w skrajnych przypadkach średnie tętno przewyższało maksymalne o kilka uderzeń na minutę. Tabela pokazała, że w prawie 30 obserwacjach występuje taki błąd.
:::

## Naprawa danych

::: {style="text-align: justify"}
W celu wykonania dalszej analizy należało naprawić dane, które nie spełniały wcześniej ustalonych reguł. Przyjęto założenie, że błąd wynika z niedoszacowania wartości Max_BPM (np. chwilowego braku odczytu w momencie faktycznego maksimum), natomiast średnie tętno jest bardziej stabilne i wiarygodne. Dlatego zdecydowano skorygować wyłącznie maksymalne tętno. Dla wszystkich obserwacji, w których średnie tętno było większe lub równe maksymalnego, zwiększono maksymalne o 1 uderzenie na minutę względem wartości średniej. Zmiana ta jest bardzo niewielka, nie wpływa istotnie na rozkład zmiennej, a jednocześnie przywraca logiczną relację pomiędzy średnim i maksymalnym tętnem. Aby być pewnym, że dane zostały poprawione, ponownie sprawdzono zgodność danych z regułami, co zostało przedstawione na poniższym wykresie.
:::

```{r echo=FALSE}
# korekta: ustawiamy Max_BPM o 1 uderzenie/minutę wyżej niż Avg_BPM
dane_imp$Max_BPM[bpm_err] <- dane_imp$Avg_BPM[bpm_err] + 1

# Walidacja danych po poprawkach
dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
barplot(cf, main = "dane_imp_po_poprawkach")

```

::: {style="text-align: justify"}
Wyniki przedstawione na powyższym wykresie potwierdzają, że proces naprawczy zakończył się sukcesem. Widać, że wszystkie zdefiniowane reguły zostały spełnione. Całkowite wyeliminowanie błędów oznacza, że zbiór jest obecnie kompletny i gotowy do przeprowadzenia analiz statystycznych oraz weryfikacji postawionych pytań badawczych.
:::

# Analiza opisowa

::: {style="text-align: justify"}
Kolejnym etapem było przeprowadzenie analizy opisowej, mającej na celu scharakteryzowanie zbioru danych pod kątem podstawowych statystyk oraz rozkładów zmiennych. Analiza ta pozwala zrozumieć strukturę danych oraz dokonać wstępnej oceny porównawczej badanych parametrów.
:::

```{r message=FALSE, warning=FALSE, include=FALSE}
# Ujednolicenie nazw i etykiet do tabel i wykresów
dane_desc <- dane_imp %>%
  rename(
    Weight = `Weight (kg)`,
    Height = `Height (m)`,
    Session_Duration = `Session_Duration (hours)`,
    Water_Intake = `Water_Intake (liters)`,
    Workout_Frequency = `Workout_Frequency (days/week)`
  ) %>%
  mutate(
    Gender = factor(Gender,
                    levels = c("Female", "Male"),
                    labels = c("Kobieta", "Mężczyzna")),
    Workout_Type = factor(Workout_Type,
                          levels = c("Cardio", "Strength", "Yoga", "HIIT"),
                          labels = c("Cardio", "Siłowy", "Joga", "HIIT")),
    Experience_Level = factor(Experience_Level,
                              levels = c(1, 2, 3),
                              labels = c("Początkujący", "Średniozaawansowany", "Zaawansowany"))
  )

# Podstawowe informacje o danych

tibble(
Liczba_obserwacji = nrow(dane_desc),
Liczba_zmiennych = ncol(dane_desc)
)

glimpse(dane_desc)

```

::: {style="text-align: justify"}
**Podstawowe informacje o danych**

Analiza opisowa została przeprowadzona na zbiorze danych obejmującym N = 973 obserwacje, gdzie każda obserwacja odpowiada pojedynczej sesji treningowej. Zbiór zawiera informacje opisujące zarówno cechy demograficzne i antropometryczne uczestników (m.in. wiek, płeć, masa ciała, wzrost, wskaźnik BMI), jak i parametry związane z przebiegiem treningu oraz reakcją organizmu (czas trwania sesji, spalone kalorie, typ treningu, poziom nawodnienia, częstotliwość treningów w tygodniu, poziom doświadczenia, a także wybrane wskaźniki tętna).
:::

```{r echo=FALSE}
# Statystyki opisowe zmiennych liczbowych

opis_liczbowe <- dane_desc %>%
  dplyr::select(dplyr::where(is.numeric)) %>%
  tidyr::pivot_longer(cols = dplyr::everything(),
                      names_to = "Zmienna",
                      values_to = "Wartosc") %>%
  dplyr::group_by(Zmienna) %>%
  dplyr::summarise(
    n = sum(!is.na(Wartosc)),
    srednia = round(mean(Wartosc, na.rm = TRUE), 2),
    odch_sd = round(sd(Wartosc, na.rm = TRUE), 2),
    mediana = round(median(Wartosc, na.rm = TRUE), 2),
    q1 = round(quantile(Wartosc, 0.25, na.rm = TRUE), 2),
    q3 = round(quantile(Wartosc, 0.75, na.rm = TRUE), 2),
    min = round(min(Wartosc, na.rm = TRUE), 2),
    max = round(max(Wartosc, na.rm = TRUE), 2),
    .groups = "drop"
  )

opis_liczbowe
```

::: {style="text-align: justify"}
**Statystyki opisowe zmiennych liczbowych**

W tabeli zestawiono podstawowe miary położenia i zróżnicowania zmiennych liczbowych (średnia, odchylenie standardowe, mediana, kwartyle oraz wartości minimalne i maksymalne). Po przygotowaniu danych (imputacji) dla analizowanych zmiennych liczbowych nie występują braki, dlatego dla każdej zmiennej liczebność wynosi n = 973.

Struktura wieku wskazuje na dominację osób dorosłych, z wyraźnym udziałem grupy w wieku średnim. Parametry tętna (spoczynkowe, średnie i maksymalne) mieszczą się w typowych zakresach dla osób aktywnych fizycznie i cechują się umiarkowanym zróżnicowaniem między obserwacjami. Wskaźniki masy ciała (waga i BMI) są bardziej zróżnicowane, co sugeruje niejednorodność próby pod względem budowy ciała. Największą zmienność w całym zbiorze wykazują spalone kalorie, co jest spójne z różnicami w intensywności oraz czasie trwania sesji. Zmiennie związane z zachowaniami treningowymi wskazują na regularną aktywność kilku razy w tygodniu, przy typowym czasie trwania treningu około jednej godziny. Szczegółowe wartości (średnie, mediany, kwartyle oraz minima i maksima) zaprezentowano w tabeli.

Podsumowując, w danych dominuje populacja dorosłych osób trenujących regularnie 3–4 razy w tygodniu, a największe zróżnicowanie widoczne jest w spalonych kaloriach oraz w BMI/masie ciała.
:::

```{r echo=FALSE}
# Struktura próby – zmienne jakościowe (częstości)

freq_tbl <- function(x) {
tibble(kategoria = as.character(x)) %>%
count(kategoria) %>%
mutate(odsetek = round(100 * n / sum(n), 1)) %>%
arrange(desc(n))
}

freq_tbl(dane_desc$Gender)
freq_tbl(dane_desc$Workout_Type)
freq_tbl(dane_desc$Experience_Level)

```

::: {style="text-align: justify"}
**Struktura próby – zmienne jakościowe**

W tej części przedstawiono rozkłady częstości dla zmiennych jakościowych: płeć (Gender), typ treningu (Workout_Type) oraz poziom doświadczenia (Experience_Level). Analiza dotyczy pełnej próby n = 973 obserwacji (po imputacji i korekcie danych).

Struktura płci jest wyrównana: mężczyźni stanowią 52,5% (n = 511), a kobiety 47,5% (n = 462), co oznacza niewielką przewagę mężczyzn (ok. 5 p.p.). Rozkład typów treningu jest również dość równomierny — najczęściej występują treningi Cardio (27,3%) oraz Siłowe (26,9%), a nieco rzadziej Joga (23,5%) i HIIT (22,2%). Różnice między kategoriami są niewielkie (ok. 5 p.p.), co wskazuje na podobną reprezentację różnych form aktywności. W przypadku poziomu doświadczenia największą grupę stanowią osoby średniozaawansowane (41,7%), następnie początkujące (38,6%), a najmniej liczne są osoby zaawansowane (19,6%) — łącznie ok. 80% próby to poziom początkujący lub średniozaawansowany.

Podsumowując próba jest zróżnicowana pod względem analizowanych kategorii, a rozkłady są na tyle wyrównane (zwłaszcza dla typów treningu), że umożliwiają dalsze porównania między grupami bez ryzyka, że jedna kategoria „zdominuje” analizę.
:::

**Proste rozkłady wybranych zmiennych**

```{r echo=FALSE}

# Proste rozkłady wybranych zmiennych

p_age <- ggplot(dane_desc, aes(x = Age)) +
geom_histogram(bins = 20) +
labs(x = "Wiek", y = "Liczba osób")

p_bmi <- ggplot(dane_desc, aes(x = BMI)) +
geom_histogram(bins = 25) +
labs(x = "BMI", y = "Liczba osób")

p_cal <- ggplot(dane_desc, aes(x = Calories_Burned)) +
geom_histogram(bins = 25) +
labs(x = "Spalone kalorie", y = "Liczba sesji")

(p_age | p_bmi) / p_cal

```

::: {style="text-align: justify"}
Na wykresach przedstawiono histogramy wieku, BMI oraz liczby spalonych kalorii, co pozwala ocenić koncentrację obserwacji, asymetrię rozkładów oraz obecność wartości skrajnych.

Rozkład wieku jest względnie równomierny w całym analizowanym zakresie (około 18–59 lat). Nie widać wyraźnie dominującej grupy wieku, co sugeruje, że próba obejmuje szerokie spektrum osób dorosłych.

W przypadku BMI rozkład jest jednomodalny z wyraźnym ogonem prawostronnym. Najwięcej obserwacji koncentruje się w okolicach wartości typowych dla normy i lekkiej nadwagi, natomiast wraz ze wzrostem BMI częstości maleją. Widoczne są też pojedyncze wysokie wartości (około 45–50), wskazujące na obserwacje skrajne.

Rozkład spalonych kalorii również ma jeden główny szczyt i jest lekko skośny w prawo. Większość sesji mieści się w środkowym przedziale (około 700–1100 kcal), a bardzo wysokie wartości (powyżej ok. 1400–1500 kcal) występują rzadziej, podobnie jak niskie wyniki (około 300–500 kcal).

Podsumowując, spośród analizowanych zmiennych większą asymetrię i obecność wartości skrajnych obserwuje się dla BMI oraz spalonych kalorii, natomiast wiek ma rozkład bardziej równomierny.
:::

**Najsilniejsze korelacje między zmiennymi liczbowymi**

```{r echo=FALSE}
# Najsilniejsze korelacje między zmiennymi liczbowymi

cor_top10 <- dane_desc %>%
  dplyr::select_if(is.numeric) %>%
  cor(use = "pairwise.complete.obs") %>%
  as.data.frame() %>%
  tibble::rownames_to_column("Zmienna1") %>%
  tidyr::pivot_longer(-Zmienna1, names_to = "Zmienna2", values_to = "Korelacja") %>%
  dplyr::filter(Zmienna1 < Zmienna2) %>%
  dplyr::arrange(desc(abs(Korelacja))) %>%
  dplyr::slice_head(n = 10)

cor_top10

```

::: {style="text-align: justify"}
W tabeli przedstawiono 10 najsilniejszych zależności liniowych między zmiennymi liczbowymi (współczynnik korelacji Pearsona). Wartości dodatnie oznaczają współwystępowanie wzrostu obu zmiennych, a ujemne - wzrost jednej zmiennej przy spadku drugiej. Korelacje mają charakter opisowy i nie przesądzają o zależnościach przyczynowo-skutkowych.

Najsilniejszą dodatnią korelację zaobserwowano między Calories_Burned a Session_Duration (r = 0,908), co wskazuje na ścisły związek pomiędzy czasem trwania sesji a wydatkiem energetycznym. Wysoka korelacja występuje również między BMI a Weight (r = 0,853), zgodnie z konstrukcją wskaźnika BMI.

Wśród pozostałych dodatnich zależności zwracają uwagę związki między parametrami regularności treningu: Session_Duration i Workout_Frequency (r = 0,644) oraz Calories_Burned i Workout_Frequency (r = 0,576).

Najsilniejsze korelacje ujemne dotyczą zmiennej Fat_Percentage, która jest ujemnie powiązana m.in. ze spalonymi kaloriami (r = −0,598), spożyciem wody (r = −0,589), czasem sesji (r = −0,582) oraz częstotliwością treningów (r = −0,537). Dodatkowo zaobserwowano umiarkowane dodatnie korelacje Water_Intake z Weight (r = 0,394) oraz Height z Water_Intake (r = 0,394).

Podsumowując, najsilniejsze zależności dotyczą (1) relacji między czasem treningu i spalonymi kaloriami oraz (2) relacji między masą ciała i BMI, natomiast zmienna Fat_Percentage jest konsekwentnie ujemnie skorelowana z kilkoma miarami aktywności i parametrów treningu.
:::

# Wizualizacja danych

::: {style="text-align: justify"}
Kolejnym etapem, następującym po statystycznym zapoznaniu się ze zbiorem danych, jest ich wizualizacja. Pozwala ona na szybką identyfikację trendów, wartości odstających oraz kluczowych relacji, które mogą pozostawać nieuchwytne na poziomie analizy tabelarycznej. Poniższe wykresy stanowią graficzne zestawienie zmiennych w nawiązaniu do pytań badawczych.
:::

```{r include=FALSE}
# Zmiana nazwy 
dane_plot <- dane_desc
```

**Czas trwania treningu w porównaniu do spalonych kalorii**

```{r echo=FALSE}

ggplot(dane_desc, aes(x = Session_Duration, y = Calories_Burned, color = Workout_Type)) +
  geom_point(alpha = 0.4, size = 1.5) +  
  geom_smooth(method = "lm", se = FALSE, size = 1.2) + 
   facet_wrap(~ Workout_Type) +
  scale_color_viridis_d(option = "plasma") + # czytelna paleta kolorów
  labs(
    title = "Zależność spalonych kalorii od czasu trwania sesji",
    subtitle = "Z podziałem na typy aktywności i dopasowaniem linii regresji",
    x = "Czas trwania sesji (godziny)",
    y = "Spalone kalorie (kcal)",
    color = "Typ treningu"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.minor = element_blank()
  )
```

::: {style="text-align: justify"}
Wykresy rozrzutu z nałożonymi liniami regresji potwierdzają silną, dodatnią korelację liniową (r = 0,91) między czasem trwania sesji a liczbą spalonych kalorii we wszystkich analizowanych kategoriach. Zbliżone nachylenie linii regresji sugeruje, że czas trwania treningu jest głównym determinantem wydatku energetycznego, niezależnie od wybranej formy aktywności. Niemniej jednak, widoczne różnice w zagęszczeniu punktów oraz subtelne różnice w kącie nachylenia prostych (szczególnie w przypadku HIIT względem Jogi) wskazują na zróżnicowaną intensywność spalania właściwą dla poszczególnych typów treningu.
:::

**Związek wieku z tętnem spoczynkowym**

```{r echo=FALSE}

ggplot(dane_plot, aes(cut(Age, breaks = seq(15, 65, 5), right = FALSE), Resting_BPM)) +
  geom_boxplot(alpha = 0.6, outlier.alpha = 0.2) +
  labs(title = "Tętno spoczynkowe w grupach wiekowych (co 5 lat)",
       x = "Wiek (grupy)", y = "Resting_BPM") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

::: {style="text-align: justify"}
Analiza rozkładów tętna spoczynkowego w 5-letnich przedziałach wiekowych nie wykazuje systematycznego trendu wzrostowego ani spadkowego. Mediany tętna w większości grup oscylują w granicach 61–64 BPM, a zbliżona wysokość pudełek (rozstęp międzykwartylowy) świadczy o homogeniczności wariancji między grupami. Wyniki sugerują, że w analizowanej populacji wiek nie jest kluczowym determinantem tętna spoczynkowego. Znacznie większą zmienność obserwuje się na poziomie osobniczym wewnątrz każdej z grup niż pomiędzy poszczególnymi grupami wiekowymi.
:::

**Rodzaj treningu a średnie tętno użytkowników i liczba spalonych kalorii**

```{r echo=FALSE}

# Avg_BPM wg typu treningu

ggplot(dane_plot, aes(x = Workout_Type, y = Avg_BPM, fill = Workout_Type)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(aes(color = Workout_Type), width = 0.15, alpha = 0.2, size = 0.8) +
  scale_fill_viridis_d(option = "plasma") +
  scale_color_viridis_d(option = "plasma") +
  labs(
    title = "Analiza intensywności wysiłku dla różnych form aktywności",
    x = "Typ treningu", 
    y = "Średnie tętno (BPM)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )
```

```{r echo=FALSE}
# Calories_Burned wg typu treningu
ggplot(dane_plot, aes(x = Workout_Type, y = Calories_Burned, fill = Workout_Type)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(aes(color = Workout_Type), width = 0.15, alpha = 0.2, size = 0.8) +
  scale_fill_viridis_d(option = "plasma") +
  scale_color_viridis_d(option = "plasma") +
  labs(title = "Porównanie rozkładu wydatku energetycznego",
       x = "Typ treningu", 
       y = "Spalone kalorie") +
  theme_minimal() +
  theme(
    legend.position = "none", # Ukrywamy legendę, bo osie są już opisane
    plot.title = element_text(face = "bold")
  )

```

::: {style="text-align: justify"}
Analiza porównawcza średniego tętna oraz wydatku energetycznego w zależności od rodzaju aktywności wykazuje wysoki stopień homogeniczności danych. Mediany tętna oraz spalonych kalorii pozostają na zbliżonym poziomie dla wszystkich grup, co sugeruje, że w badanym zbiorze intensywność sesji była do siebie upodobniona niezależnie od dyscypliny.

Szerokie i w dużej mierze pokrywające się przedziały międzykwartylowe (pudełka) jednoznacznie wskazują na brak statystycznie istotnych różnic między typami treningu, przy czym w kategoriach HIIT oraz treningu Siłowego odnotowano pojedyncze wartości odstające, reprezentujące wydatek energetyczny przekraczający 1500 kcal.

Ostatecznie, podobnie jak w przypadku analizy wpływu wieku, wariancja wewnątrz każdej z grup dominuje nad różnicami między kategoriami aktywności, co prowadzi do wniosku, że indywidualne zaangażowanie oraz cechy osobnicze mają w tym zbiorze danych większy wpływ na końcowy wynik niż sam wybór rodzaju ćwiczeń
:::

**Poziom doświadczenia a spalanie kalorii w każdym rodzaju treningu**

```{r echo=FALSE}

ggplot(dane_plot, aes(x = Experience_Level, y = Calories_Burned, fill = Experience_Level)) +
  stat_summary(fun = "mean", geom = "bar", width = 0.7) +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), 
               vjust = -0.5, size = 3.5) +
  scale_fill_viridis_d(option = "plasma") +
  facet_wrap(~ Workout_Type) +
  coord_cartesian(clip = "off") +
  labs(title = "Średnie spalanie kalorii wg poziomu zaawansowania",
       x = "Poziom doświadczenia", 
       y = "Średnio spalone kalorie") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )

```

::: {style="text-align: justify"}
Analiza średniego wydatku energetycznego w zależności od poziomu doświadczenia ujawnia, że stopień zaawansowania ćwiczącego jest kluczowym czynnikiem determinującym liczbę spalonych kalorii we wszystkich typach treningu. Z danych wynika, że osoby zaawansowane spalają średnio o ok. 80% więcej energii niż osoby początkujące, przy czym różnice między poszczególnymi dyscyplinami sportowymi na tym samym poziomie zaawansowania pozostają marginalne. Interesującym spostrzeżeniem jest fakt, że wydatek energetyczny podczas sesji jogi na poziomie zaawansowanym (1264 kcal) jest porównywalny z treningiem HIIT czy Cardio, co podważa powszechne przekonanie o niskiej intensywności tej formy aktywności. Najwyższą średnią wartość odnotowano w grupie zaawansowanej treningu siłowego (1300 kcal), co pozwala wskazać tę formę aktywności jako potencjalnie najefektywniejszą dla osób dążących do maksymalizacji deficytu kalorycznego, o ile dysponują one odpowiednim przygotowaniem technicznym.
:::

**Wpływ płci na intensywność wysiłku fizycznego oraz poziom wydatku energetycznego.**

```{r echo=FALSE}

# Średnie tętno (Avf_BPM) wg płci

ggplot(dane_plot, aes(x = Gender, y = Avg_BPM, fill = Gender)) +
  geom_boxplot() +
  labs(title = "Różnice w średnim tętnie między płciami",
       x = "Płeć", y = "Avg_BPM") +
  theme_minimal() +
  theme(legend.position = "none")

# Maksymalne tętno (Max_BPM) wg płci

ggplot(dane_plot, aes(x = Gender, y = Max_BPM, fill = Gender)) +
  geom_boxplot() +
  labs(
    title = "Różnice w Maksymalnym Tętnie między Płciami",
    x = "Płeć",
    y = "Maksymalne Tętno"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# Spalone kalorie (Calories_Burned) wg płci

ggplot(dane_plot, aes(x = Gender, y = Calories_Burned, fill = Gender)) +
  geom_boxplot() +
  labs(
    title = "Różnice w Spalonych Kaloriach między Płciami",
    x = "Płeć",
    y = "Spalone Kalorie"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

::: {style="text-align: justify"}
Analiza tętna nie wykazuje istotnych różnic między płciami, co świadczy o zbliżonej intensywności treningów u kobiet i mężczyzn. Mimo podobnego obciążenia kardiologicznego, mężczyźni charakteryzują się wyższym wydatkiem energetycznym. Różnica ta wynika z uwarunkowań fizjologicznych – większa masa ciała oraz udział tkanki mięśniowej u mężczyzn generują wyższy koszt kaloryczny przy zachowaniu tego samego poziomu tętna.
:::

**Wpływ BMI oraz procentowej zawartości tkanki tłuszczowej na efektywność treningową**

```{r echo=FALSE}
dane_calc <- dane_plot %>%
  mutate(
    Efficiency = Calories_Burned / Session_Duration,
    BMI_Group = cut(BMI, breaks = c(0, 18.5, 25, 30, 100), 
                    labels = c("Niedowaga", "Norma", "Nadwaga", "Otyłość")),
    Fat_Group = cut(Fat_Percentage, breaks = c(0, 15, 25, 100), 
                    labels = c("Sportowa (<15%)", "Przeciętna", "Wysoka (>25%)"))
  )

p1 <- ggplot(dane_calc %>% filter(!is.na(BMI_Group)), 
             aes(x = BMI_Group, y = Efficiency, fill = BMI_Group)) +
  stat_summary(fun = "mean", geom = "bar") +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), vjust = -0.5) +
  labs(title = "Efektywność wg BMI", x = "Grupa BMI", y = "Kcal / Godzinę") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() + 
  theme(legend.position = "none") +
  coord_cartesian(clip = "off")

p2 <- ggplot(dane_calc %>% filter(!is.na(Fat_Group)), 
             aes(x = Fat_Group, y = Efficiency, fill = Fat_Group)) +
  stat_summary(fun = "mean", geom = "bar") +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = after_stat(round(y, 0))), vjust = -0.5) +
  labs(title = "Efektywność wg % Tłuszczu", x = "% Tłuszczu", y = "") +
  scale_fill_brewer(palette = "Reds") +
  theme_minimal() + 
  theme(legend.position = "none") +
  coord_cartesian(clip = "off")

p1 + p2 + 
  plot_annotation(
    title = "Analiza efektywności treningu",
    subtitle = "Średnie spalanie kalorii na godzinę w zależności od składu ciała"
  )
```

::: {style="text-align: justify"}
Analiza parametrów składu ciała jako predyktorów efektywności treningowej ujawnia istotne różnice między wskaźnikiem BMI a procentową zawartością tkanki tłuszczowej. W przypadku BMI zauważalny wzrost wydatku energetycznego występuje jedynie w grupie z otyłością (751 kcal/h), co wynika bezpośrednio z wysokiego kosztu fizycznego przemieszczania większej masy ciała, podczas gdy dla pozostałych grup różnice są marginalne. Zgoła odmienną tendencję obserwujemy przy analizie poziomu tkanki tłuszczowej, gdzie występuje wyraźna korelacja ujemna – najwyższą efektywność (759 kcal/h) osiągają osoby o sportowej sylwetce. Potwierdza to tezę, że to nie ogólna masa, lecz wysoki udział beztłuszczowej masy mięśniowej jest kluczowym determinantem tempa spalania kalorii, co czyni procent tkanki tłuszczowej znacznie bardziej precyzyjnym wskaźnikiem efektywności treningu niż BMI.
:::

**Wpływ częstotliwości treningów w tygodniu na kluczowe wskaźniki zdrowotne (BMI, Resting_BPM)**

```{r echo=FALSE}
# 7a. Wpływ częstotliwości na BMI
ggplot(dane_plot, aes(x = factor(Workout_Frequency), y = BMI, fill = factor(Workout_Frequency))) +
  geom_boxplot(alpha = 0.6, color = "darkgrey") +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1) +
  scale_fill_viridis_d(option = "mako", begin = 0.3, end = 0.8) +
  labs(title = "Częstotliwość treningów a BMI",
       subtitle = "Rozkład wskaźnika masy ciała względem liczby treningów w tygodniu",
       x = "Liczba treningów w tygodniu",
       y = "BMI",
       fill = "Dni/Tydzień") +
  theme_minimal() +
  theme(legend.position = "none")

# 7b. Wpływ częstotliwości na Tętno Spoczynkowe (Resting_BPM)
ggplot(dane_plot, aes(x = factor(Workout_Frequency), y = Resting_BPM, fill = factor(Workout_Frequency))) +
  geom_boxplot(alpha = 0.6, color = "darkgrey") +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1) +
  scale_fill_viridis_d(option = "rocket", begin = 0.3, end = 0.8) +
  labs(title = "Częstotliwość treningów a tętno spoczynkowe",
       subtitle = "Czy regularność treningów poprawia tętno spoczynkowe?",
       x = "Liczba treningów w tygodniu",
       y = "Resting_BPM (uderzenia/min)",
       fill = "Dni/Tydzień") +
  theme_minimal() +
  theme(legend.position = "none")
```

::: {style="text-align: justify"}
Analiza wykresów wykazuje, że wysoka częstotliwość treningów (5 sesji/tydz.) pełni przede wszystkim rolę stabilizującą parametry zdrowotne. W przypadku BMI, u osób trenujących najczęściej obserwujemy najwyższy stopień koncentracji wyników wokół mediany oraz wyraźne ograniczenie występowania wartości bardzo wysokich (powyżej 35 BMI), co sugeruje, że wysoka regularność sprzyja utrzymaniu stabilnej masy ciała. Chociaż mediany BMI (ok. 24–25) oraz tętna spoczynkowego (ok. 61–63 BPM) pozostają zbliżone we wszystkich grupach, to właśnie w grupie o najwyższej aktywności rozkład BMI jest najbardziej zwarty. Regularność działa więc jako mechanizm ograniczający zmienność parametrów zdrowotnych, przy czym jej bezpośredni wpływ na obniżenie wartości przeciętnych jest obecny, lecz ma charakter umiarkowany.
:::

**Identyfikacja homogenicznych grup (klastrów) użytkowników o zbliżonych profilach fizjologicznych i wzorcach aktywności**

```{r echo=FALSE}
dane_do_klastrowania <- dane_plot %>% 
  dplyr::select(BMI, Fat_Percentage)

set.seed(123) # Stały punkt startowy, aby wyniki były zawsze takie same
klastry <- kmeans(dane_do_klastrowania, centers = 3)

dane_plot$Grupa <- as.factor(klastry$cluster)

ggplot(dane_plot, aes(x = BMI, y = Fat_Percentage, color = Grupa)) +
  geom_point(alpha = 0.6, size = 2.5) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Segmentacja użytkowników (Analiza skupień)",
       subtitle = "Podział na 3 grupy na podstawie BMI oraz tkanki tłuszczowej",
       x = "Wskaźnik BMI",
       y = "Procent tkanki tłuszczowej (%)",
       color = "Klaster (Grupa)") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

::: {style="text-align: justify"}
Algorytm klastrowania wyodrębnił trzy grupy użytkowników o różnych profilach budowy ciała. Wyraźna korelacja dodatnia między BMI a procentem tkanki tłuszczowej pozwoliła na precyzyjną segmentację: Grupa 2 (niebieska) to osoby o sylwetkach atletycznych, Grupa 3 (zielona) obejmuje użytkowników o standardowej budowie, a Grupa 1 (czerwona) skupia osoby o najwyższych parametrach, będące głównymi kandydatami do programów redukcyjnych. Taki podział umożliwia automatyczną personalizację planów treningowych i ofert bez konieczności ręcznej analizy każdego klienta.
:::

**Analiza czynników determinujących średnie tętno (Avg_BPM) podczas sesji treningowej.**

```{r echo=FALSE}
dane_kor <- dane_plot %>%
  dplyr::select(Avg_BPM, Max_BPM, Age, Weight, Height, 
                Session_Duration, Calories_Burned, 
                Fat_Percentage, Water_Intake, Workout_Frequency, BMI)

kor_wyniki <- as.data.frame(cor(dane_kor, use = "complete.obs")["Avg_BPM", ])
colnames(kor_wyniki) <- "Korelacja"
kor_wyniki$Zmienna <- rownames(kor_wyniki)
kor_wyniki <- kor_wyniki %>%
  filter(Zmienna != "Avg_BPM") %>%
  arrange(desc(abs(Korelacja)))

ggplot(kor_wyniki, aes(x = reorder(Zmienna, Korelacja), y = Korelacja, fill = Korelacja)) +
  geom_bar(stat = "identity") +
  coord_flip() + # Wykres poziomy dla lepszej czytelności nazw
  scale_fill_gradient2(low = "#4575b4", mid = "#ffffbf", high = "#d73027", midpoint = 0) +
  labs(title = "Czynniki wpływające na średnie tętno (Avg_BPM)",
       subtitle = "Siła powiązania parametrów z intensywnością wysiłku",
       x = "Parametr",
       y = "Współczynnik korelacji") +
  theme_minimal() +
  theme(legend.position = "none")
```

::: {style="text-align: justify"}
Głównym czynnikiem spalania kalorii jest czas trwania treningu oraz poziom doświadczenia, gdzie osoby zaawansowane osiągają o 80% wyższe wyniki (do 1300 kcal), niezależnie od dyscypliny. Rodzaj aktywności, wiek i BMI mają znikomy wpływ na tętno podczas ćwiczeń, które zależy głównie od dynamiki samej sesji. Mężczyźni, mimo podobnej intensywności tętna co kobiety, spalają więcej energii dzięki większej masie mięśniowej. Wskaźnik tkanki tłuszczowej jest precyzyjniejszym predyktorem wydajności niż BMI, a regularność (5 treningów tygodniowo) kluczowo stabilizuje tętno spoczynkowe i wagę. Automatyczna segmentacja użytkowników pozwala na trafne wyodrębnienie grup atletycznych i redukcyjnych.
:::

**Zależność między ilością spożytej wody a efektywnością spalania kalorii i średnim tętnem.**

```{r echo=FALSE}
dane_grupy <- dane_plot %>%
  mutate(Calorie_Group = cut(Calories_Burned, 
                             breaks = seq(0, 2000, by = 250),
                             labels = c("0-250", "251-500", "501-750", "751-1000", 
                                        "1001-1250", "1251-1500", "1501-1750", "1751+"))) %>%
  filter(!is.na(Calorie_Group)) %>%
  group_by(Calorie_Group) %>%
  summarise(Avg_Water = mean(Water_Intake, na.rm = TRUE),
            n = n())
ggplot(dane_grupy, aes(x = Calorie_Group, y = Avg_Water, fill = Avg_Water)) +
  geom_bar(stat = "identity", color = "white", alpha = 0.8) +
  geom_text(aes(label = round(Avg_Water, 2)), v_just = -0.5, size = 3.5) +
  scale_fill_gradient(low = "#85c1e9", high = "#21618c") +
  labs(title = "Średnie spożycie wody w zależności od spalonych kalorii",
       subtitle = "Wyraźny trend: im większy wydatek energetyczny, tym więcej wypitej wody",
       x = "Przedział spalonych kalorii (kcal)",
       y = "Średnia ilość wody (litry)",
       fill = "Litry") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

::: {style="text-align: justify"}
Analiza wykresu kolumnowego wykazuje bezpośrednią i liniową zależność między wydajnością treningową a nawodnieniem, wskazując, że oba te parametry rosną niemal równolegle. Podział danych na konkretne przedziały energetyczne pozwolił wyeliminować indywidualne odchylenia i ukazać stały trend wzrostowy: podczas gdy osoby spalające do 500 kcal wypijają średnio około 2 litrów wody, w grupach o najwyższej wydajności (powyżej 1750 kcal) średnie spożycie płynów wyraźnie wzrasta, osiągając najwyższe wartości. Taki układ danych jednoznacznie potwierdza, że zapotrzebowanie na wodę jest ściśle skorelowane z objętością wykonanej pracy, co sugeruje, że wyższe spożycie płynów stanowi fizjologiczną konieczność przy sesjach o wysokim wydatku energetycznym.
:::

# Wnioskowanie statystyczne

::: {style="text-align: justify"}
W niniejszej części analizy przechodzimy od obserwacji opisowych do formalnego wnioskowania statystycznego. Celem tego etapu jest zweryfikowanie, czy zależności i różnice zaobserwowane w zbiorze danych (obejmującym 973 obserwacje) mają charakter systematyczny, czy też mogą być jedynie wynikiem przypadku. Traktujemy posiadane dane jako próbę, co pozwala nam na wyciąganie wniosków dotyczących szerszej populacji osób podejmujących aktywność fizyczną.

Wnioskowanie statystyczne oparto na integracji metod wizualnych z formalnymi testami statystycznymi, ograniczając ich zakres wyłącznie do postawionych pytań badawczych w celu zachowania przejrzystości analizy.

Przyjęto rygorystyczny poziom istotności alpha = 0,05, stosując jednocześnie korektę wartości p metodą Holma lub Benjamini-Hochberg (BH) w przypadku serii testów wykonywanych w ramach jednego pytania. Procedura ta pozwala na skuteczną kontrolę błędu I rodzaju i minimalizuje ryzyko błędnego uznania przypadkowych różnic za istotne statystycznie.
:::

```{r echo=FALSE, message=FALSE, warning=FALSE}
alpha <- 0.05
```

**Pytanie 1: Czas trwania a kalorie – czy zależność zależy od typu treningu?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy związek między czasem trwania treningu a liczbą spalonych kalorii różni się w zależności od typu treningu.

**Metoda:** Dopasowano model regresji liniowej z interakcją Session_Duration (h) \* Workout_Type i przetestowano istotność interakcji (ANOVA dla modelu, testy F).
:::

```{r echo=FALSE}

# Model z interakcją
m1 <- lm(Calories_Burned ~ Session_Duration * Workout_Type, data = dane_plot)
car::Anova(m1, type = 2)

# Ponieważ interakcja nieistotna -> model uproszczony
m1_simpler <- lm(Calories_Burned ~ Session_Duration + Workout_Type, data = dane_plot)
summary(m1_simpler)

```

::: {style="text-align: justify"}
Głównym predyktorem liczby spalonych kalorii jest czas trwania sesji (p \< 0,001), podczas gdy rodzaj treningu oraz efekty interakcji okazały się nieistotne statystycznie. Model regresji wyjaśnia aż 82,5% zmienności zjawiska. Wynika z niego, że każda minuta treningu przekłada się średnio na spalenie ok. 12 kcal, niezależnie od dyscypliny. Pozwala to przyjąć czas trwania sesji za główny wskaźnik wydatku energetycznego w badanym panelu.
:::

**Pytanie 2: Wiek a tętno spoczynkowe**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy wiek jest związany z tętnem spoczynkowym.

**Metoda:** Zastosowano korelację rang Spearmana.
:::

```{r echo=FALSE}
cor.test(dane_plot$Age, dane_plot$Resting_BPM, method = "spearman")

```

::: {style="text-align: justify"}
Analiza korelacji rang Spearmana wykazała brak istotnej zależności między wiekiem a tętnem spoczynkowym. Uzyskany współczynnik bliski zeru jednoznacznie wskazuje na brak związku między tymi zmiennymi, co potwierdza, że w badanym zbiorze wiek nie jest predyktorem tętna spoczynkowego. Większa zmienność parametru występuje raczej między poszczególnymi osobami wewnątrz grup niż pomiędzy różnymi kohortami wiekowymi.
:::

**Pytanie 3: Czy rodzaj treningu wpływa na Avg_BPM i Calories_Burned?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy średnie wartości Avg_BPM oraz Calories_Burned różnią się w zależności od typu treningu.

**Metoda:** Zastosowano jednoczynnikową analizę wariancji Welcha (ANOVA Welcha), która nie zakłada równości wariancji między grupami.
:::

```{r echo=FALSE}
# ANOVA Welcha (bez założenia równości wariancji)
oneway.test(Avg_BPM ~ Workout_Type, data = dane_plot)
oneway.test(Calories_Burned ~ Workout_Type, data = dane_plot)
```

::: {style="text-align: justify"}
Przeprowadzona analiza testem ANOVA Welcha nie dostarczyła dowodów na istnienie istotnych różnic w średnim tętnie oraz liczbie spalonych kalorii pomiędzy analizowanymi typami treningów ($p > 0.05$ dla obu zmiennych). Oznacza to, że niezależnie od wybranej formy aktywności – czy był to trening HIIT, siłowy, joga czy cardio – średnie obciążenie organizmu i wydatek energetyczny pozostawały na zbliżonym poziomie. Sugeruje to, że o intensywności treningu w tej grupie decydowały czynniki inne niż sam rodzaj wybranej aktywności fizycznej.
:::

**Pytanie 4: Experience_Level a kalorie – czy efekt zależy od Workout_Type?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy poziom doświadczenia wpływa na liczbę spalonych kalorii oraz czy ten wpływ różni się w zależności od typu treningu.

**Metoda:** Dopasowano model regresji liniowej z interakcją Experience_Level \* Workout_Type. Następnie wykonano porównania post-hoc poziomów doświadczenia osobno w każdym typie treningu metodą emmeans z korektą BH.
:::

```{r echo=FALSE}
m4 <- lm(Calories_Burned ~ Experience_Level * Workout_Type, data = dane_plot)
car::Anova(m4, type = 2)

plot(emmeans(m4, ~ Experience_Level | Workout_Type), comparisons = TRUE)
```

::: {style="text-align: justify"}
Analiza wykazała, że poziom doświadczenia ma kluczowy i statystycznie istotny wpływ na liczbę spalonych kalorii (p \< 0,001). Osoby o wyższym stopniu zaawansowania spalają znacznie więcej kalorii niż osoby początkujące, co wyraźnie obrazuje wykres średnich szacowanych (emmeans). Co istotne, brak znaczącej interakcji między doświadczeniem a rodzajem treningu (p = 0,4263) wskazuje, że ten wzrost wydatku energetycznego postępuje w sposób zbliżony we wszystkich analizowanych dyscyplinach. Rodzaj treningu sam w sobie nie różnicował istotnie wyników (p = 0,6169), co potwierdza, że to staż treningowy, a nie dyscyplina, jest głównym predyktorem spalonych kalorii w tym modelu.
:::

**Pytanie 5: Różnice Kobieta vs Mężczyzna (Avg_BPM, Max_BPM, Calories_Burned)**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy kobiety i mężczyźni różnią się pod względem średniego tętna w trakcie treningu (Avg_BPM), maksymalnego tętna (Max_BPM) oraz liczby spalonych kalorii (Calories_Burned).

**Metoda:** Zastosowano test t Welcha dla dwóch niezależnych prób. Ponieważ wykonano trzy testy jednocześnie, uwzględniono korektę wartości p metodą Holma.
:::

```{r echo=FALSE}
t_avg <- t.test(Avg_BPM ~ Gender, data = dane_plot)
t_max <- t.test(Max_BPM ~ Gender, data = dane_plot)
t_cal <- t.test(Calories_Burned ~ Gender, data = dane_plot)

t_avg; t_max; t_cal

# korekta na 3 testy
p.adjust(c(t_avg$p.value, t_max$p.value, t_cal$p.value), method = "holm")

```

::: {style="text-align: justify"}
Analiza wykazała brak istotnych różnic między kobietami i mężczyznami pod względem średniego oraz maksymalnego tętna zarówno przed jak i po uwzględnieniu korekty wartości p metodą Holma. Obie grupy trenowały z podobną intensywnością sercową. Natomiast odnotowano istotną statystycznie różnicę w liczbie spalonych kalorii, która po korekcie wynosiła mniej niż 0,0001. Mężczyźni spalali średnio o 82,2 kcal więcej niż kobiety (944,5 vs 862,3 kcal), co przy braku różnic w tętnie sugeruje wpływ innych czynników, np. różnic w masie ciała lub składzie tkanek.
:::

**Pytanie 6: Czy BMI i Fat_Percentage przewidują efektywność?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są związane z efektywnością treningu zdefiniowaną jako Efficiency = Calories_Burned / Session_Duration.

**Metoda:** Utworzono zmienną Efficiency, a następnie dopasowano model regresji liniowej wielorakiej: Efficiency \~ BMI + Fat_Percentage.
:::

```{r echo=FALSE}
# przygotowanie danych do analizy efektywności
dane_calc <- dane_plot %>%
  mutate(Efficiency = Calories_Burned / Session_Duration) %>%
  filter(is.finite(Efficiency))

# regresja wieloraka
m6 <- lm(Efficiency ~ BMI + Fat_Percentage, data = dane_calc)
summary(m6)
```

::: {style="text-align: justify"}
Model regresji liniowej wykazał, że zarówno BMI, jak i procentowa zawartość tkanki tłuszczowej są istotnymi predyktorami efektywności spalania kalorii. Odnotowano przeciwstawne kierunki tych zależności: wyższe BMI sprzyja większemu wydatkowi energetycznemu (wzrost o 1,85 kcal/min na jednostkę BMI), natomiast wyższy poziom tkanki tłuszczowej obniża tę efektywność (spadek o 2,15 kcal/min na każdy 1% tłuszczu). Niska wartość skorygowanego współczynnika determinacji sugeruje jednak, że budowa ciała wyjaśnia jedynie niewielką część całkowitej zmienności tempa spalania kalorii.
:::

**Pytanie 7: Czy Workout_Frequency wpływa na BMI i Resting_BPM?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy częstotliwość treningów w tygodniu (Workout_Frequency) wiąże się z różnicami w BMI oraz tętnie spoczynkowym (Resting_BPM).

**Metoda:** Zastosowano jednoczynnikową analizę wariancji Welcha (ANOVA Welcha), traktując Workout_Frequency jako zmienną grupującą (kategorie).
:::

```{r echo=FALSE}
test_bmi1 <- oneway.test(BMI ~ factor(Workout_Frequency), data = dane_plot)
test_bmi1
test_bpm1 <- oneway.test(Resting_BPM ~ factor(Workout_Frequency), data = dane_plot)
test_bpm1
# Korekta p value
p_values <- c(test_bmi1$p.value, test_bpm1$p.value)
p.adjust(p_values, method = "holm")
```

::: {style="text-align: justify"}
Analiza ANOVA Welcha nie wskazała istotnych różnic wskaźnika BMI (p=0,544) oraz tętna spoczynkowego (p=0,979) w zależności od częstotliwości treningów w tygodniu. Po zastosowaniu korekty Holma, oba wyniki osiągnęły wartość równą 1, co potwierdza brak istotności statystycznej obu zmiennych.
:::

**Pytanie 8: Segmentacja (k-średnich) – czy klastry różnią się czymś więcej?**

::: {style="text-align: justify"}
**Cel:** Podział badanej populacji na grupy na podstawie parametrów budowy ciała (BMI oraz % tkanki tłuszczowej) i sprawdzenie, czy te grupy różnią się między sobą pod względem innych cech demograficznych, wydolnościowych i treningowych.

**Metoda:** Algorytm k-średnich (k=3) na ustandaryzowanych danych. Zbadanie zmiennych ilościowych testem ANOVA Welcha z korektą Holma dla wielokrotnych porównań. W przypadku zmiennych jakościowych wykorzystanie testu niezależności chi-kwadrat.
:::

```{r echo=FALSE}
set.seed(123)
dane_plot$Grupa <- factor(kmeans(scale(dane_plot[,c("BMI","Fat_Percentage")]),
                                 centers=3, nstart=25)$cluster)
dane_plot %>% group_by(Grupa) %>%
  summarise(n=n(), BMI=mean(BMI), Fat=mean(Fat_Percentage),
            Age=mean(Age), Cal=mean(Calories_Burned), Dur=mean(Session_Duration),
            Freq=mean(Workout_Frequency), .groups="drop")
vars <- c("Age","Calories_Burned","Session_Duration","Workout_Frequency","Resting_BPM","Avg_BPM")
p <- sapply(vars, \(v) oneway.test(reformulate("Grupa", v), data=dane_plot)$p.value)
data.frame(zmienna=vars, p=p, p_holm=p.adjust(p, "holm")) |> arrange(p_holm)

# (opcjonalnie) zmienne jakościowe (chi^2)
sapply(c("Gender","Workout_Type","Experience_Level"),
       \(v) chisq.test(table(dane_plot$Grupa, dane_plot[[v]]))$p.value)
```

::: {style="text-align: justify"}
Segmentacja wykazała, że osoby o najniższym BMI i poziomie tkanki tłuszczowej (Grupa 2) są jednocześnie najbardziej aktywne, wykonując średnio ponad 4 treningi tygodniowo i spalając o ok. 50% więcej kalorii niż pozostałe grupy. Mimo znaczących różnic w sylwetce i intensywności ćwiczeń (p\_{holm} \< 0,05), parametry tętna spoczynkowego oraz wiek badanych pozostają niemal identyczne we wszystkich klastrach. Analiza struktury grup potwierdza, że na profil budowy ciała silnie wpływa płeć oraz staż treningowy, natomiast sam rodzaj wybranej aktywności (np. Cardio vs Strength) nie różnicuje istotnie wydzielonych segmentów.
:::

**Pytanie 9: Co najbardziej wpływa na Avg_BPM?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, które cechy użytkownika i treningu są statystycznie związane ze średnim tętnem podczas treningu (Avg_BPM), przy jednoczesnej kontroli pozostałych zmiennych.

**Metoda:** Zastosowano regresję liniową wieloraką, uwzględniając jednocześnie parametry treningowe i fizyczne (m.in. czas trwania, kalorie, wiek, BMI, płeć, typ treningu).
:::

```{r echo=FALSE}
m9 <- lm(
  Avg_BPM ~ Max_BPM + Session_Duration + Calories_Burned + Age +
    BMI + Fat_Percentage + Water_Intake + Workout_Frequency +
    Gender + Workout_Type + Experience_Level,
  data = dane_plot
)

summary(m9)
car::vif(m9)
```

::: {style="text-align: justify"}
Głównymi determinantami średniego tętna są czas trwania sesji, spalone kalorie oraz wiek, które wykazują bardzo wysoką istotność statystyczną (p \< 2e-16). Model wyjaśnia aż 80% zmienności, przy czym bycie mężczyzną wiąże się ze znaczącym spadkiem średniego tętna (o ok. 11,5 uderzeń na minutę) w porównaniu do kobiet, przy zachowaniu pozostałych parametrów na stałym poziomie. Co istotne, czynniki takie jak BMI, częstotliwość treningów czy poziom doświadczenia nie mają statystycznie istotnego wpływu na wartość Avg_BPM w tym modelu.
:::

**Pytanie 10: Czy Water_Intake ma związek z wydajnością?**

::: {style="text-align: justify"}
**Cel:** Sprawdzić, czy ilość wypijanej wody (Water_Intake) jest związana ze spalonymi kaloriami (Calories_Burned) oraz ze średnim tętnem (Avg_BPM). Dodatkowo oceniono, czy związek z kaloriami utrzymuje się po uwzględnieniu czasu trwania treningu i typu treningu.

**Metoda:** Zastosowano korelację rang Spearmana (dla prostych zależności) oraz regresję liniową Calories_Burned \~ Water_Intake + Session_Duration + Workout_Type w celu kontroli czasu i typu treningu.
:::

```{r echo=FALSE}
cor.test(dane_plot$Water_Intake, dane_plot$Calories_Burned, method = "spearman", exact = FALSE)
cor.test(dane_plot$Water_Intake, dane_plot$Avg_BPM, method = "spearman", exact = FALSE)

m10 <- lm(Calories_Burned ~ Water_Intake + Session_Duration + Workout_Type, data = dane_plot)
summary(m10)

```

::: {style="text-align: justify"}
Ilość wypijanej wody jest umiarkowanie powiązana z większym wydatkiem energetycznym – każda dodatkowa jednostka nawodnienia wiąże się ze wzrostem spalonych kalorii o około 49 kcal. Zależność ta pozostaje statystycznie bardzo istotna (p \< 0,001) nawet przy uwzględnieniu czasu trwania i typu treningu. Jednocześnie badania nie wykazały żadnego istotnego związku między spożyciem wody a średnim tętnem podczas ćwiczeń (p = 0,858). Oznacza to, że nawodnienie sprzyja efektywności spalania kalorii, nie wpływając bezpośrednio na intensywność pracy serca.
:::

# Podsumowanie i wnioski

::: {style="text-align: justify"}
W ramach projektu przeanalizowano dane obejmujące 973 obserwacje dotyczące sesji treningowych członków siłowni, zawierające informacje demograficzne, parametry fizjologiczne oraz miary aktywności i wydajności treningowej. Na początku przeprowadzono czyszczenie danych (identyfikacja braków, imputacja oraz wyliczenie BMI), a następnie walidację logiczną. Wykryto niezgodność relacji Avg_BPM \< Max_BPM w ok. 30 przypadkach, którą skorygowano minimalną modyfikacją wartości maksymalnego tętna. Po poprawkach zbiór spełniał wszystkie zdefiniowane reguły i został uznany za gotowy do wnioskowania.
:::

::: {style="text-align: justify"}
Najważniejsze wyniki wskazują, że czas trwania treningu jest najsilniejszym czynnikiem powiązanym ze spalonymi kaloriami, a zależność ta nie różni się istotnie między typami treningu. Wiek nie wykazał związku z tętnem spoczynkowym, a rodzaj aktywności (Cardio/Siłowy/Joga/HIIT) nie różnicował istotnie średniego tętna ani spalonych kalorii. Z kolei poziom doświadczenia istotnie zwiększał wydatek energetyczny w każdej dyscyplinie. Płeć nie różnicowała tętna, natomiast mężczyźni spalali średnio więcej kalorii. W analizie składu ciała BMI i % tłuszczu były istotnymi predyktorami efektywności, ale wyjaśniały tylko niewielką część jej zmienności. Częstotliwość treningów nie wiązała się istotnie z BMI ani tętnem spoczynkowym. Klastrowanie na podstawie BMI i % tłuszczu pozwoliło wyodrębnić trzy sensowne segmenty użytkowników. Dodatkowo, nawodnienie było dodatnio powiązane ze spalonymi kaloriami (także po kontroli czasu trwania), natomiast nie wykazano związku z Avg_BPM.
:::

::: {style="text-align: justify"}
Podsumowując, analiza wskazuje, że w badanym zbiorze kluczowe znaczenie dla wydatku energetycznego mają przede wszystkim czas trwania sesji oraz poziom doświadczenia, natomiast sam typ treningu odgrywa rolę drugorzędną. Wyniki należy interpretować ostrożnie ze względu na obserwacyjny charakter danych oraz brak zmiennych opisujących realną intensywność i obciążenie treningowe. W przyszłości warto rozszerzyć zbiór o miary intensywności (np. strefy tętna, tempo, obciążenia), co mogłoby poprawić wyjaśnianie różnic w efektywności treningu.
:::
