---
title: "Analiza danych - siłownia"
author: "Oliwia Kolendowska, Magdalena Łuciw, Maja Milewczyk"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
library(tidyverse)
dane <- read_csv("dane/silownia_new.csv")
```

# Wstęp

Celem projektu zespołowego realizowanego w roku akademickim 2025/2026 jest analiza danych dotyczących aktywności użytkowników siłowni, obejmująca zarówno ich charakterystyki demograficzne, jak i wskaźniki związane z wydajnością treningową. Projekt ma na celu zrozumienie, jakie czynniki wpływają na efektywność ćwiczeń oraz jakie wzorce zachowań można zaobserwować wśród osób regularnie korzystających z siłowni.

## Opis danych

W projekcie wykorzystujemy zbiór danych obejmujący 973 rekordy dotyczące członków siłowni. Każdy wpis zawiera zestaw informacji demograficznych, fizjologicznych oraz dotyczących nawyków treningowych. Dane pozwalają analizować zarówno podstawowe parametry zdrowotne, jak i bardziej zaawansowane wskaźniki wydajności.

Najważniejsze zmienne w zbiorze:

**Wiek** – wiek użytkownika siłowni w latach.

**Płeć** – mężczyzna lub kobieta.

**Waga** (kg) – masa ciała w kilogramach.

**Wzrost** (m) – wzrost użytkownika w metrach.

**Max_BPM** – maksymalne tętno zanotowane podczas sesji treningowej.

**Avg_BPM** – średnie tętno podczas treningu.

**Resting_BPM** – tętno spoczynkowe przed rozpoczęciem ćwiczeń.

**Session_Duration** (h) – czas trwania sesji treningowej wyrażony w godzinach.

**Calories_Burned** – liczba kalorii spalonych w trakcie treningu.

**Workout_Type** – rodzaj aktywności (np. kardio, trening siłowy, joga, HIIT).

**Fat_Percentage** – procent tkanki tłuszczowej.

**Water_Intake** (litry) – ilość wody wypitej w ciągu dnia treningowego.

**Workout_Frequency** (dni/tydzień) – ile dni w tygodniu użytkownik ćwiczy.

**Experience_Level** – poziom doświadczenia treningowego (1 – początkujący, 2 – średniozaawansowany, 3 – zaawansowany).

**BMI** – wskaźnik masy ciała oparty na wzroście i wadze.

Zakres danych umożliwia analizę zależności pomiędzy cechami fizycznymi, stylem treningów i nawykami a realnymi wynikami osiąganymi podczas ćwiczeń.

## Pytania badawcze

**1.** Czy czas trwania treningu wpływa na liczbę spalonych kalorii, a zależność różni się w zależności od typu treningu?

**2.** Czy wiek (Age) ma związek z tętnem spoczynkowym (Resting_BPM)?

**3.** Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?

**4.** Czy poziom doświadczenia (Experience_Level) wiąże się z większą wydajnością treningową (np. wyższym Calories_Burned lub niższym Avg_BPM)?

**5.** Czy BMI oraz procent tkanki tłuszczowej (Fat_Percentage) są dobrymi predyktorami efektywności treningu?

**6.** Czy występują różnice między kobietami i mężczyznami w intensywności treningów (Avg_BPM, Max_BPM) oraz w liczbie spalonych kalorii?

**7.** Czy częstotliwość ćwiczeń w tygodniu (Workout_Frequency) wpływa na wskaźniki zdrowotne, takie jak BMI czy Resting_BPM?

**8.** Czy w zbiorze danych można wyróżnić wyraźne grupy (klastry) użytkowników o podobnych parametrach fizycznych i treningowych?

**9.** Które zmienne najbardziej wpływają na średnie tętno podczas treningu (Avg_BPM)?

**10.** Czy ilość wypitej wody (Water_Intake) ma zauważalny związek z wydajnością treningową (Calories_Burned, Avg_BPM)?

# Porządkowanie i czyszczenie danych

## Braki danych

```{r}
install.packages("naniar")
install.packages("vars")
library(vars)
library(naniar)
procent <- prop_complete_var(dane)*100
procent
```

```{r}
install.packages("VIM")
library(VIM)
VIM::aggr(dane_imp, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(dane_imp), cex.axis=.7, gap=3, ylab=c("Procent braków danych","Wzorzec braków danych"))
```
W danych znajduje się 80% kompletnych wartości. 

```{r}
naniar::vis_miss(dane)
```

## Wzorzec braków danych

```{r}
install.packages("finalfit")
library(finalfit)
missing_pattern(dane)
```

## Imputacje danych

```{r}
dane$BMI <- dane$`Weight (kg)`/dane$`Height (m)`^2
dane_imp <- hotdeck(dane)
naniar::prop_miss(dane_imp)
```

# Walidacja danych

## Reguły 

```{r}

dane$rec_id <- sprintf("%03d", 1:nrow(dane))

library(validate)
rules <- validator(
# 1. Wiek
Age >= 10,
Age <= 140,

# 2. Płeć
Gender %in% c("Male", "Female"),

# 3. Masa i wzrost
`Weight (kg)` >= 30,
`Weight (kg)` <= 250,
`Height (m)` >= 1.00,
`Height (m)` <= 2.50,

# 4. Spójność tętna
Resting_BPM >= 30,
Resting_BPM <= 120,
Max_BPM >= 100,
Max_BPM <= 220,
Avg_BPM > Resting_BPM,
Avg_BPM < Max_BPM,

# 5. Czas sesji
`Session_Duration (hours)` > 0,

# 6. Kalorie 
Calories_Burned > 0,
  
# 7. Dopuszczalne typy treningu (Workout_Type)
Workout_Type %in% c("Cardio", "Strength", "Yoga", "HIIT"),

# 8. Zakres zawartości tkanki tłuszczowej (Fat_Percentage)
Fat_Percentage >= 0,
Fat_Percentage <= 70,

# 9. Zakres spożycia wody (Water_Intake (liters))
`Water_Intake (liters)` > 0,

# 10. Częstotliwość treningów w tygodniu (Workout_Frequency (days/week))
`Workout_Frequency (days/week)` >= 1,
`Workout_Frequency (days/week)` <= 7,

# 11. Poziom doświadczenia (Experience_Level)
Experience_Level %in% c(1, 2, 3),

# 12. Zakres BMI
  BMI >= 10,
  BMI <= 60,

# 13. Spójność BMI z masą i wzrostem
abs(BMI - `Weight (kg)` / (`Height (m)`^2)) <= 0.01)

cf <- confront(dane, rules, key = "rec_id")
summary(cf)
barplot(cf, main = "dane")

# Identyfikacja rekordów niespełniających reguły Avg_BPM < Max_BPM
bpm_err <- which(dane_imp$Avg_BPM >= dane_imp$Max_BPM)
```
## Naprawa danych

Po uzupełnieniu braków danych i zastosowaniu reguł walidacyjnych sprawdziliśmy, czy w zbiorze nie pozostały wartości sprzeczne logicznie. Większość obserwacji spełniała przyjęte warunki dotyczące wieku, wzrostu, masy ciała, BMI, czasu trwania treningu czy spalonych kalorii.

Jedyny problem dotyczył zmiennych opisujących tętno. W kilku rekordach średnie tętno podczas treningu (Avg_BPM) było równe lub nawet wyższe niż maksymalne zarejestrowane tętno (Max_BPM). Taka sytuacja jest nielogiczna, bo zgodnie z definicją to tętno maksymalne powinno być najwyższą wartością z całej sesji.

Założyliśmy, że błąd wynika z niedoszacowania wartości Max_BPM (np. chwilowego braku odczytu w momencie faktycznego maksimum), natomiast średnie tętno jest bardziej stabilne i wiarygodne. Dlatego zdecydowaliśmy się korygować wyłącznie Max_BPM. Dla wszystkich obserwacji, w których Avg_BPM było większe lub równe Max_BPM, zwiększyliśmy Max_BPM o 1 uderzenie na minutę względem wartości średniej. Zmiana ta jest bardzo niewielka, nie wpływa istotnie na rozkład zmiennej, a jednocześnie przywraca logiczną relację pomiędzy średnim i maksymalnym tętnem.

Po wprowadzeniu tej poprawki ponownie uruchomiliśmy procedurę walidacji. Wszystkie reguły zostały spełnione, a w danych nie pozostały już obserwacje oznaczone jako błędne.

```{r}
# Podgląd danych przed poprawą
dane_imp[bpm_err, c("Age", "Gender", "Resting_BPM", "Avg_BPM", "Max_BPM")]

# korekta: ustawiamy Max_BPM o 1 uderzenie/minutę wyżej niż Avg_BPM
dane_imp$Max_BPM[bpm_err] <- dane_imp$Avg_BPM[bpm_err] + 1

# Walidacja danych po poprawkach
dane_imp$rec_id <- sprintf("%03d", 1:nrow(dane_imp))
cf <- confront(dane_imp, rules, key = "rec_id")
summary(cf)
barplot(cf, main = "dane_imp_po_poprawkach")

```

# Wizualizacja danych 

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(forcats)

dane_plot <- dane_imp %>%
rename(
Weight = `Weight (kg)`,
Height = `Height (m)`,
Session_Duration = `Session_Duration (hours)`,
Water_Intake = `Water_Intake (liters)`,
Workout_Frequency = `Workout_Frequency (days/week)`
) %>%
mutate(
Gender = factor(Gender, levels = c("Female", "Male"),
labels = c("Kobieta", "Mężczyzna")),
Experience_Level = factor(Experience_Level,
levels = c(1, 2, 3),
labels = c("Początkujący",
"Średniozaawansowany",
"Zaawansowany"))
)
```

## Pytanie 1: Czy czas trwania treningu wpływa na liczbę spalonych kalorii, a zależność różni się w zależności od typu treningu?

```{r}
ggplot(dane_plot, aes(Session_Duration, Calories_Burned)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ Workout_Type) +
  labs(title = "Spalone kalorie a czas trwania – osobno dla typów treningu",
       x = "Czas trwania [h]", y = "Spalone kalorie") +
  theme_minimal()
```

## Na wykresach (osobno dla każdego typu treningu) widoczna jest wyraźna dodatnia zależność między czasem trwania sesji a liczbą spalonych kalorii — wraz ze wzrostem Session_Duration rośnie Calories_Burned. Linie regresji w poszczególnych panelach mają podobne nachylenie, co sugeruje, że sam wpływ czasu na spalanie kalorii jest zbliżony niezależnie od rodzaju aktywności. Jednocześnie zauważalne są niewielkie różnice w poziomie spalania kalorii (rozrzut i położenie punktów), co może oznaczać, że typ treningu w pewnym stopniu wpływa na liczbę spalonych kalorii, ale głównym czynnikiem pozostaje czas trwania ćwiczeń.



## Pytanie 2: Czy wiek (Age) ma związek z tętnem spoczynkowym (Resting_BPM)?

```{r}

ggplot(dane_plot, aes(cut(Age, breaks = seq(15, 65, 5), right = FALSE), Resting_BPM)) +
  geom_boxplot(alpha = 0.6, outlier.alpha = 0.2) +
  labs(title = "Tętno spoczynkowe w grupach wiekowych (co 5 lat)",
       x = "Wiek (grupy)", y = "Resting_BPM") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Porównanie rozkładów tętna spoczynkowego w 5-letnich grupach wiekowych nie pokazuje wyraźnego, systematycznego trendu wzrostowego ani spadkowego. Mediany Resting_BPM w większości przedziałów są do siebie zbliżone (około niskich 60 BPM), a rozrzut wyników w grupach jest podobny. Oznacza to, że w analizowanym zbiorze wiek sam w sobie nie wydaje się silnie związany z tętnem spoczynkowym — większe różnice w Resting_BPM występują raczej między pojedynczymi osobami (wewnątrz grup) niż pomiędzy grupami wiekowymi.

## Pytanie 3: Czy rodzaj treningu (Workout_Type) wpływa na średnie tętno użytkowników i liczbę spalonych kalorii?

```{r}

# Avg_BPM wg typu treningu

ggplot(dane_plot, aes(Workout_Type, Avg_BPM)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(width = 0.15, alpha = 0.15, size = 0.8) +
  labs(title = "Średnie tętno (Avg_BPM) wg typu treningu",
       x = "Typ treningu", y = "Avg_BPM") +
  theme_minimal()

# Calories_Burned wg typu treningu
ggplot(dane_plot, aes(Workout_Type, Calories_Burned)) +
  geom_boxplot(alpha = 0.5, outlier.alpha = 0.2) +
  geom_jitter(width = 0.15, alpha = 0.15, size = 0.8) +
  labs(title = "Spalone kalorie wg typu treningu",
       x = "Typ treningu", y = "Calories_Burned") +
  theme_minimal()

```

## Na wykresach porównano rozkład średniego tętna (Avg_BPM) oraz liczby spalonych kalorii (Calories_Burned) w zależności od typu treningu (Workout_Type). W przypadku średniego tętna mediany i rozrzut wartości są bardzo podobne dla wszystkich typów (Cardio, HIIT, Strength, Yoga), co sugeruje, że rodzaj treningu nie różnicuje wyraźnie średniego poziomu tętna podczas sesji. Dla spalonych kalorii również widoczne jest duże nakładanie się rozkładów pomiędzy grupami — różnice w medianach są niewielkie, a w każdej kategorii występują wartości skrajne. Ogólnie wskazuje to, że w tym zbiorze danych typ treningu ma co najwyżej umiarkowany wpływ na Avg_BPM i Calories_Burned, a większa zmienność występuje pomiędzy osobami niż pomiędzy samymi typami aktywności.